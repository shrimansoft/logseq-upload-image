(function(){const Z=document.createElement("link").relList;if(Z&&Z.supports&&Z.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))oe(D);new MutationObserver(D=>{for(const X of D)if(X.type==="childList")for(const A of X.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&oe(A)}).observe(document,{childList:!0,subtree:!0});function se(D){const X={};return D.integrity&&(X.integrity=D.integrity),D.referrerPolicy&&(X.referrerPolicy=D.referrerPolicy),D.crossOrigin==="use-credentials"?X.credentials="include":D.crossOrigin==="anonymous"?X.credentials="omit":X.credentials="same-origin",X}function oe(D){if(D.ep)return;D.ep=!0;const X=se(D);fetch(D.href,X)}})();const go="modulepreload",mo=function(K,Z){return new URL(K,Z).href},_n={},yo=function(Z,se,oe){let D=Promise.resolve();if(se&&se.length>0){const A=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),w=c?.nonce||c?.getAttribute("nonce");D=Promise.allSettled(se.map(C=>{if(C=mo(C,oe),C in _n)return;_n[C]=!0;const S=C.endsWith(".css"),N=S?'[rel="stylesheet"]':"";if(!!oe)for(let d=A.length-1;d>=0;d--){const b=A[d];if(b.href===C&&(!S||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${C}"]${N}`))return;const h=document.createElement("link");if(h.rel=S?"stylesheet":go,S||(h.as="script"),h.crossOrigin="",h.href=C,w&&h.setAttribute("nonce",w),document.head.appendChild(h),S)return new Promise((d,b)=>{h.addEventListener("load",d),h.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${C}`)))})}))}function X(A){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=A,window.dispatchEvent(c),!c.defaultPrevented)throw A}return D.then(A=>{for(const c of A||[])c.status==="rejected"&&X(c.reason);return Z().catch(X)})};var vr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},br={exports:{}};/*! For license information please see lsplugin.user.js.LICENSE.txt */br.exports;(function(K,Z){(function(se,oe){K.exports=oe()})(self,()=>(()=>{var se={227:(A,c,w)=>{var C=w(155);c.formatArgs=function(N){if(N[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+N[0]+(this.useColors?"%c ":" ")+"+"+A.exports.humanize(this.diff),!this.useColors)return;const q="color: "+this.color;N.splice(1,0,q,"color: inherit");let h=0,d=0;N[0].replace(/%[a-zA-Z%]/g,b=>{b!=="%%"&&(h++,b==="%c"&&(d=h))}),N.splice(d,0,q)},c.save=function(N){try{N?c.storage.setItem("debug",N):c.storage.removeItem("debug")}catch{}},c.load=function(){let N;try{N=c.storage.getItem("debug")}catch{}return!N&&C!==void 0&&"env"in C&&(N=C.env.DEBUG),N},c.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},c.storage=function(){try{return localStorage}catch{}}(),c.destroy=(()=>{let N=!1;return()=>{N||(N=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),A.exports=w(447)(c);const{formatters:S}=A.exports;S.j=function(N){try{return JSON.stringify(N)}catch(q){return"[UnexpectedJSONParseError]: "+q.message}}},447:(A,c,w)=>{A.exports=function(C){function S(h){let d,b,f,m=null;function _(...L){if(!_.enabled)return;const R=_,T=Number(new Date),k=T-(d||T);R.diff=k,R.prev=d,R.curr=T,d=T,L[0]=S.coerce(L[0]),typeof L[0]!="string"&&L.unshift("%O");let i=0;L[0]=L[0].replace(/%([a-zA-Z%])/g,(l,y)=>{if(l==="%%")return"%";i++;const v=S.formatters[y];if(typeof v=="function"){const W=L[i];l=v.call(R,W),L.splice(i,1),i--}return l}),S.formatArgs.call(R,L),(R.log||S.log).apply(R,L)}return _.namespace=h,_.useColors=S.useColors(),_.color=S.selectColor(h),_.extend=N,_.destroy=S.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(b!==S.namespaces&&(b=S.namespaces,f=S.enabled(h)),f),set:L=>{m=L}}),typeof S.init=="function"&&S.init(_),_}function N(h,d){const b=S(this.namespace+(d===void 0?":":d)+h);return b.log=this.log,b}function q(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return S.debug=S,S.default=S,S.coerce=function(h){return h instanceof Error?h.stack||h.message:h},S.disable=function(){const h=[...S.names.map(q),...S.skips.map(q).map(d=>"-"+d)].join(",");return S.enable(""),h},S.enable=function(h){let d;S.save(h),S.namespaces=h,S.names=[],S.skips=[];const b=(typeof h=="string"?h:"").split(/[\s,]+/),f=b.length;for(d=0;d<f;d++)b[d]&&((h=b[d].replace(/\*/g,".*?"))[0]==="-"?S.skips.push(new RegExp("^"+h.slice(1)+"$")):S.names.push(new RegExp("^"+h+"$")))},S.enabled=function(h){if(h[h.length-1]==="*")return!0;let d,b;for(d=0,b=S.skips.length;d<b;d++)if(S.skips[d].test(h))return!1;for(d=0,b=S.names.length;d<b;d++)if(S.names[d].test(h))return!0;return!1},S.humanize=w(824),S.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(C).forEach(h=>{S[h]=C[h]}),S.names=[],S.skips=[],S.formatters={},S.selectColor=function(h){let d=0;for(let b=0;b<h.length;b++)d=(d<<5)-d+h.charCodeAt(b),d|=0;return S.colors[Math.abs(d)%S.colors.length]},S.enable(S.load()),S}},996:A=>{var c=function(f){return function(m){return!!m&&typeof m=="object"}(f)&&!function(m){var _=Object.prototype.toString.call(m);return _==="[object RegExp]"||_==="[object Date]"||function(L){return L.$$typeof===w}(m)}(f)},w=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function C(f,m){return m.clone!==!1&&m.isMergeableObject(f)?d((_=f,Array.isArray(_)?[]:{}),f,m):f;var _}function S(f,m,_){return f.concat(m).map(function(L){return C(L,_)})}function N(f){return Object.keys(f).concat(function(m){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(m).filter(function(_){return Object.propertyIsEnumerable.call(m,_)}):[]}(f))}function q(f,m){try{return m in f}catch{return!1}}function h(f,m,_){var L={};return _.isMergeableObject(f)&&N(f).forEach(function(R){L[R]=C(f[R],_)}),N(m).forEach(function(R){(function(T,k){return q(T,k)&&!(Object.hasOwnProperty.call(T,k)&&Object.propertyIsEnumerable.call(T,k))})(f,R)||(q(f,R)&&_.isMergeableObject(m[R])?L[R]=function(T,k){if(!k.customMerge)return d;var i=k.customMerge(T);return typeof i=="function"?i:d}(R,_)(f[R],m[R],_):L[R]=C(m[R],_))}),L}function d(f,m,_){(_=_||{}).arrayMerge=_.arrayMerge||S,_.isMergeableObject=_.isMergeableObject||c,_.cloneUnlessOtherwiseSpecified=C;var L=Array.isArray(m);return L===Array.isArray(f)?L?_.arrayMerge(f,m,_):h(f,m,_):C(m,_)}d.all=function(f,m){if(!Array.isArray(f))throw new Error("first argument should be an array");return f.reduce(function(_,L){return d(_,L,m)},{})};var b=d;A.exports=b},856:function(A){A.exports=function(){function c(E){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(E)}function w(E,M){return w=Object.setPrototypeOf||function(B,V){return B.__proto__=V,B},w(E,M)}function C(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(E,M,B){return S=C()?Reflect.construct:function(V,he,Re){var We=[null];We.push.apply(We,he);var tt=new(Function.bind.apply(V,We));return Re&&w(tt,Re.prototype),tt},S.apply(null,arguments)}function N(E){return q(E)||h(E)||d(E)||f()}function q(E){if(Array.isArray(E))return b(E)}function h(E){if(typeof Symbol<"u"&&E[Symbol.iterator]!=null||E["@@iterator"]!=null)return Array.from(E)}function d(E,M){if(E){if(typeof E=="string")return b(E,M);var B=Object.prototype.toString.call(E).slice(8,-1);return B==="Object"&&E.constructor&&(B=E.constructor.name),B==="Map"||B==="Set"?Array.from(E):B==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(B)?b(E,M):void 0}}function b(E,M){(M==null||M>E.length)&&(M=E.length);for(var B=0,V=new Array(M);B<M;B++)V[B]=E[B];return V}function f(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=Object.hasOwnProperty,_=Object.setPrototypeOf,L=Object.isFrozen,R=Object.getPrototypeOf,T=Object.getOwnPropertyDescriptor,k=Object.freeze,i=Object.seal,l=Object.create,y=typeof Reflect<"u"&&Reflect,v=y.apply,W=y.construct;v||(v=function(E,M,B){return E.apply(M,B)}),k||(k=function(E){return E}),i||(i=function(E){return E}),W||(W=function(E,M){return S(E,N(M))});var ee=Q(Array.prototype.forEach),ae=Q(Array.prototype.pop),pe=Q(Array.prototype.push),we=Q(String.prototype.toLowerCase),Ce=Q(String.prototype.match),be=Q(String.prototype.replace),St=Q(String.prototype.indexOf),p=Q(String.prototype.trim),x=Q(RegExp.prototype.test),$=Se(TypeError);function Q(E){return function(M){for(var B=arguments.length,V=new Array(B>1?B-1:0),he=1;he<B;he++)V[he-1]=arguments[he];return v(E,M,V)}}function Se(E){return function(){for(var M=arguments.length,B=new Array(M),V=0;V<M;V++)B[V]=arguments[V];return W(E,B)}}function P(E,M){_&&_(E,null);for(var B=M.length;B--;){var V=M[B];if(typeof V=="string"){var he=we(V);he!==V&&(L(M)||(M[B]=he),V=he)}E[V]=!0}return E}function J(E){var M,B=l(null);for(M in E)v(m,E,[M])&&(B[M]=E[M]);return B}function ie(E,M){for(;E!==null;){var B=T(E,M);if(B){if(B.get)return Q(B.get);if(typeof B.value=="function")return Q(B.value)}E=R(E)}function V(he){return console.warn("fallback value for",he),null}return V}var Ee=k(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),xe=k(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ie=k(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),et=k(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),fe=k(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),le=k(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Oe=k(["#text"]),Ae=k(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Pe=k(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ze=k(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Le=k(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),je=i(/\{\{[\w\W]*|[\w\W]*\}\}/gm),dt=i(/<%[\w\W]*|[\w\W]*%>/gm),_r=i(/^data-[\-\w.\u00B7-\uFFFF]/),Fe=i(/^aria-[\-\w]+$/),He=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Vt=i(/^(?:\w+script|data):/i),wr=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),xr=i(/^html$/i),pt=function(){return typeof window>"u"?null:window},Cr=function(E,M){if(c(E)!=="object"||typeof E.createPolicy!="function")return null;var B=null,V="data-tt-policy-suffix";M.currentScript&&M.currentScript.hasAttribute(V)&&(B=M.currentScript.getAttribute(V));var he="dompurify"+(B?"#"+B:"");try{return E.createPolicy(he,{createHTML:function(Re){return Re}})}catch{return console.warn("TrustedTypes policy "+he+" could not be created."),null}};function Zt(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pt(),M=function(o){return Zt(o)};if(M.version="2.3.8",M.removed=[],!E||!E.document||E.document.nodeType!==9)return M.isSupported=!1,M;var B=E.document,V=E.document,he=E.DocumentFragment,Re=E.HTMLTemplateElement,We=E.Node,tt=E.Element,Pt=E.NodeFilter,Kt=E.NamedNodeMap,Ke=Kt===void 0?E.NamedNodeMap||E.MozNamedAttrMap:Kt,Sr=E.HTMLFormElement,Or=E.DOMParser,kr=E.trustedTypes,Ot=tt.prototype,Er=ie(Ot,"cloneNode"),Ar=ie(Ot,"nextSibling"),jr=ie(Ot,"childNodes"),Ft=ie(Ot,"parentNode");if(typeof Re=="function"){var Ue=V.createElement("template");Ue.content&&Ue.content.ownerDocument&&(V=Ue.content.ownerDocument)}var $e=Cr(kr,B),Yt=$e?$e.createHTML(""):"",kt=V,Rt=kt.implementation,rt=kt.createNodeIterator,Qt=kt.createDocumentFragment,Xt=kt.getElementsByTagName,Tr=B.importNode,er={};try{er=J(V).documentMode?V.documentMode:{}}catch{}var Me={};M.isSupported=typeof Ft=="function"&&Rt&&Rt.createHTMLDocument!==void 0&&er!==9;var ht,Ge,Et=je,At=dt,Ut=_r,Ir=Fe,tr=Vt,jt=wr,te=He,ge=null,rr=P({},[].concat(N(Ee),N(xe),N(Ie),N(fe),N(Oe))),me=null,nt=P({},[].concat(N(Ae),N(Pe),N(Ze),N(Le))),ue=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ot=null,Tt=null,$t=!0,Dt=!0,nr=!1,it=!1,Ye=!1,zt=!1,Bt=!1,st=!1,It=!1,at=!1,or=!0,qt=!0,ct=!1,De={},lt=null,ir=P({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),sr=null,ar=P({},["audio","video","img","source","image","track"]),Ht=null,Qe=P({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ut="http://www.w3.org/1998/Math/MathML",Wt="http://www.w3.org/2000/svg",Je="http://www.w3.org/1999/xhtml",Lt=Je,cr=!1,gt=["application/xhtml+xml","text/html"],mt="text/html",ft=null,Lr=V.createElement("form"),lr=function(o){return o instanceof RegExp||o instanceof Function},Gt=function(o){ft&&ft===o||(o&&c(o)==="object"||(o={}),o=J(o),ge="ALLOWED_TAGS"in o?P({},o.ALLOWED_TAGS):rr,me="ALLOWED_ATTR"in o?P({},o.ALLOWED_ATTR):nt,Ht="ADD_URI_SAFE_ATTR"in o?P(J(Qe),o.ADD_URI_SAFE_ATTR):Qe,sr="ADD_DATA_URI_TAGS"in o?P(J(ar),o.ADD_DATA_URI_TAGS):ar,lt="FORBID_CONTENTS"in o?P({},o.FORBID_CONTENTS):ir,ot="FORBID_TAGS"in o?P({},o.FORBID_TAGS):{},Tt="FORBID_ATTR"in o?P({},o.FORBID_ATTR):{},De="USE_PROFILES"in o&&o.USE_PROFILES,$t=o.ALLOW_ARIA_ATTR!==!1,Dt=o.ALLOW_DATA_ATTR!==!1,nr=o.ALLOW_UNKNOWN_PROTOCOLS||!1,it=o.SAFE_FOR_TEMPLATES||!1,Ye=o.WHOLE_DOCUMENT||!1,st=o.RETURN_DOM||!1,It=o.RETURN_DOM_FRAGMENT||!1,at=o.RETURN_TRUSTED_TYPE||!1,Bt=o.FORCE_BODY||!1,or=o.SANITIZE_DOM!==!1,qt=o.KEEP_CONTENT!==!1,ct=o.IN_PLACE||!1,te=o.ALLOWED_URI_REGEXP||te,Lt=o.NAMESPACE||Je,o.CUSTOM_ELEMENT_HANDLING&&lr(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ue.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&lr(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ue.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ue.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ht=ht=gt.indexOf(o.PARSER_MEDIA_TYPE)===-1?mt:o.PARSER_MEDIA_TYPE,Ge=ht==="application/xhtml+xml"?function(I){return I}:we,it&&(Dt=!1),It&&(st=!0),De&&(ge=P({},N(Oe)),me=[],De.html===!0&&(P(ge,Ee),P(me,Ae)),De.svg===!0&&(P(ge,xe),P(me,Pe),P(me,Le)),De.svgFilters===!0&&(P(ge,Ie),P(me,Pe),P(me,Le)),De.mathMl===!0&&(P(ge,fe),P(me,Ze),P(me,Le))),o.ADD_TAGS&&(ge===rr&&(ge=J(ge)),P(ge,o.ADD_TAGS)),o.ADD_ATTR&&(me===nt&&(me=J(me)),P(me,o.ADD_ATTR)),o.ADD_URI_SAFE_ATTR&&P(Ht,o.ADD_URI_SAFE_ATTR),o.FORBID_CONTENTS&&(lt===ir&&(lt=J(lt)),P(lt,o.FORBID_CONTENTS)),qt&&(ge["#text"]=!0),Ye&&P(ge,["html","head","body"]),ge.table&&(P(ge,["tbody"]),delete ot.tbody),k&&k(o),ft=o)},ur=P({},["mi","mo","mn","ms","mtext"]),fr=P({},["foreignobject","desc","title","annotation-xml"]),Mr=P({},["title","style","font","a","script"]),ze=P({},xe);P(ze,Ie),P(ze,et);var Mt=P({},fe);P(Mt,le);var Nr=function(o){var I=Ft(o);I&&I.tagName||(I={namespaceURI:Je,tagName:"template"});var O=we(o.tagName),re=we(I.tagName);return o.namespaceURI===Wt?I.namespaceURI===Je?O==="svg":I.namespaceURI===ut?O==="svg"&&(re==="annotation-xml"||ur[re]):!!ze[O]:o.namespaceURI===ut?I.namespaceURI===Je?O==="math":I.namespaceURI===Wt?O==="math"&&fr[re]:!!Mt[O]:o.namespaceURI===Je&&!(I.namespaceURI===Wt&&!fr[re])&&!(I.namespaceURI===ut&&!ur[re])&&!Mt[O]&&(Mr[O]||!ze[O])},Be=function(o){pe(M.removed,{element:o});try{o.parentNode.removeChild(o)}catch{try{o.outerHTML=Yt}catch{o.remove()}}},yt=function(o,I){try{pe(M.removed,{attribute:I.getAttributeNode(o),from:I})}catch{pe(M.removed,{attribute:null,from:I})}if(I.removeAttribute(o),o==="is"&&!me[o])if(st||It)try{Be(I)}catch{}else try{I.setAttribute(o,"")}catch{}},dr=function(o){var I,O;if(Bt)o="<remove></remove>"+o;else{var re=Ce(o,/^[\r\n\t ]+/);O=re&&re[0]}ht==="application/xhtml+xml"&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");var de=$e?$e.createHTML(o):o;if(Lt===Je)try{I=new Or().parseFromString(de,ht)}catch{}if(!I||!I.documentElement){I=Rt.createDocument(Lt,"template",null);try{I.documentElement.innerHTML=cr?"":de}catch{}}var _e=I.body||I.documentElement;return o&&O&&_e.insertBefore(V.createTextNode(O),_e.childNodes[0]||null),Lt===Je?Xt.call(I,Ye?"html":"body")[0]:Ye?I.documentElement:_e},pr=function(o){return rt.call(o.ownerDocument||o,o,Pt.SHOW_ELEMENT|Pt.SHOW_COMMENT|Pt.SHOW_TEXT,null,!1)},Pr=function(o){return o instanceof Sr&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof Ke)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function")},vt=function(o){return c(We)==="object"?o instanceof We:o&&c(o)==="object"&&typeof o.nodeType=="number"&&typeof o.nodeName=="string"},ke=function(o,I,O){Me[o]&&ee(Me[o],function(re){re.call(M,I,O,ft)})},bt=function(o){var I;if(ke("beforeSanitizeElements",o,null),Pr(o)||x(/[\u0080-\uFFFF]/,o.nodeName))return Be(o),!0;var O=Ge(o.nodeName);if(ke("uponSanitizeElement",o,{tagName:O,allowedTags:ge}),o.hasChildNodes()&&!vt(o.firstElementChild)&&(!vt(o.content)||!vt(o.content.firstElementChild))&&x(/<[/\w]/g,o.innerHTML)&&x(/<[/\w]/g,o.textContent)||O==="select"&&x(/<template/i,o.innerHTML))return Be(o),!0;if(!ge[O]||ot[O]){if(!ot[O]&&Xe(O)&&(ue.tagNameCheck instanceof RegExp&&x(ue.tagNameCheck,O)||ue.tagNameCheck instanceof Function&&ue.tagNameCheck(O)))return!1;if(qt&&!lt[O]){var re=Ft(o)||o.parentNode,de=jr(o)||o.childNodes;if(de&&re)for(var _e=de.length-1;_e>=0;--_e)re.insertBefore(Er(de[_e],!0),Ar(o))}return Be(o),!0}return o instanceof tt&&!Nr(o)?(Be(o),!0):O!=="noscript"&&O!=="noembed"||!x(/<\/no(script|embed)/i,o.innerHTML)?(it&&o.nodeType===3&&(I=o.textContent,I=be(I,Et," "),I=be(I,At," "),o.textContent!==I&&(pe(M.removed,{element:o.cloneNode()}),o.textContent=I)),ke("afterSanitizeElements",o,null),!1):(Be(o),!0)},hr=function(o,I,O){if(or&&(I==="id"||I==="name")&&(O in V||O in Lr))return!1;if(!(Dt&&!Tt[I]&&x(Ut,I))){if(!($t&&x(Ir,I))){if(!me[I]||Tt[I]){if(!(Xe(o)&&(ue.tagNameCheck instanceof RegExp&&x(ue.tagNameCheck,o)||ue.tagNameCheck instanceof Function&&ue.tagNameCheck(o))&&(ue.attributeNameCheck instanceof RegExp&&x(ue.attributeNameCheck,I)||ue.attributeNameCheck instanceof Function&&ue.attributeNameCheck(I))||I==="is"&&ue.allowCustomizedBuiltInElements&&(ue.tagNameCheck instanceof RegExp&&x(ue.tagNameCheck,O)||ue.tagNameCheck instanceof Function&&ue.tagNameCheck(O))))return!1}else if(!Ht[I]){if(!x(te,be(O,jt,""))){if((I!=="src"&&I!=="xlink:href"&&I!=="href"||o==="script"||St(O,"data:")!==0||!sr[o])&&!(nr&&!x(tr,be(O,jt,"")))){if(O)return!1}}}}}return!0},Xe=function(o){return o.indexOf("-")>0},_t=function(o){var I,O,re,de;ke("beforeSanitizeAttributes",o,null);var _e=o.attributes;if(_e){var ye={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:me};for(de=_e.length;de--;){var wt=I=_e[de],Ve=wt.name,Te=wt.namespaceURI;if(O=Ve==="value"?I.value:p(I.value),re=Ge(Ve),ye.attrName=re,ye.attrValue=O,ye.keepAttr=!0,ye.forceKeepAttr=void 0,ke("uponSanitizeAttribute",o,ye),O=ye.attrValue,!ye.forceKeepAttr&&(yt(Ve,o),ye.keepAttr))if(x(/\/>/i,O))yt(Ve,o);else{it&&(O=be(O,Et," "),O=be(O,At," "));var Jt=Ge(o.nodeName);if(hr(Jt,re,O))try{Te?o.setAttributeNS(Te,Ve,O):o.setAttribute(Ve,O),ae(M.removed)}catch{}}}ke("afterSanitizeAttributes",o,null)}},Fr=function o(I){var O,re=pr(I);for(ke("beforeSanitizeShadowDOM",I,null);O=re.nextNode();)ke("uponSanitizeShadowNode",O,null),bt(O)||(O.content instanceof he&&o(O.content),_t(O));ke("afterSanitizeShadowDOM",I,null)};return M.sanitize=function(o,I){var O,re,de,_e,ye;if((cr=!o)&&(o="<!-->"),typeof o!="string"&&!vt(o)){if(typeof o.toString!="function")throw $("toString is not a function");if(typeof(o=o.toString())!="string")throw $("dirty is not a string, aborting")}if(!M.isSupported){if(c(E.toStaticHTML)==="object"||typeof E.toStaticHTML=="function"){if(typeof o=="string")return E.toStaticHTML(o);if(vt(o))return E.toStaticHTML(o.outerHTML)}return o}if(zt||Gt(I),M.removed=[],typeof o=="string"&&(ct=!1),ct){if(o.nodeName){var wt=Ge(o.nodeName);if(!ge[wt]||ot[wt])throw $("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof We)(re=(O=dr("<!---->")).ownerDocument.importNode(o,!0)).nodeType===1&&re.nodeName==="BODY"||re.nodeName==="HTML"?O=re:O.appendChild(re);else{if(!st&&!it&&!Ye&&o.indexOf("<")===-1)return $e&&at?$e.createHTML(o):o;if(!(O=dr(o)))return st?null:at?Yt:""}O&&Bt&&Be(O.firstChild);for(var Ve=pr(ct?o:O);de=Ve.nextNode();)de.nodeType===3&&de===_e||bt(de)||(de.content instanceof he&&Fr(de.content),_t(de),_e=de);if(_e=null,ct)return o;if(st){if(It)for(ye=Qt.call(O.ownerDocument);O.firstChild;)ye.appendChild(O.firstChild);else ye=O;return me.shadowroot&&(ye=Tr.call(B,ye,!0)),ye}var Te=Ye?O.outerHTML:O.innerHTML;return Ye&&ge["!doctype"]&&O.ownerDocument&&O.ownerDocument.doctype&&O.ownerDocument.doctype.name&&x(xr,O.ownerDocument.doctype.name)&&(Te="<!DOCTYPE "+O.ownerDocument.doctype.name+`>
`+Te),it&&(Te=be(Te,Et," "),Te=be(Te,At," ")),$e&&at?$e.createHTML(Te):Te},M.setConfig=function(o){Gt(o),zt=!0},M.clearConfig=function(){ft=null,zt=!1},M.isValidAttribute=function(o,I,O){ft||Gt({});var re=Ge(o),de=Ge(I);return hr(re,de,O)},M.addHook=function(o,I){typeof I=="function"&&(Me[o]=Me[o]||[],pe(Me[o],I))},M.removeHook=function(o){if(Me[o])return ae(Me[o])},M.removeHooks=function(o){Me[o]&&(Me[o]=[])},M.removeAllHooks=function(){Me={}},M}return Zt()}()},729:A=>{var c=Object.prototype.hasOwnProperty,w="~";function C(){}function S(d,b,f){this.fn=d,this.context=b,this.once=f||!1}function N(d,b,f,m,_){if(typeof f!="function")throw new TypeError("The listener must be a function");var L=new S(f,m||d,_),R=w?w+b:b;return d._events[R]?d._events[R].fn?d._events[R]=[d._events[R],L]:d._events[R].push(L):(d._events[R]=L,d._eventsCount++),d}function q(d,b){--d._eventsCount==0?d._events=new C:delete d._events[b]}function h(){this._events=new C,this._eventsCount=0}Object.create&&(C.prototype=Object.create(null),new C().__proto__||(w=!1)),h.prototype.eventNames=function(){var d,b,f=[];if(this._eventsCount===0)return f;for(b in d=this._events)c.call(d,b)&&f.push(w?b.slice(1):b);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(d)):f},h.prototype.listeners=function(d){var b=w?w+d:d,f=this._events[b];if(!f)return[];if(f.fn)return[f.fn];for(var m=0,_=f.length,L=new Array(_);m<_;m++)L[m]=f[m].fn;return L},h.prototype.listenerCount=function(d){var b=w?w+d:d,f=this._events[b];return f?f.fn?1:f.length:0},h.prototype.emit=function(d,b,f,m,_,L){var R=w?w+d:d;if(!this._events[R])return!1;var T,k,i=this._events[R],l=arguments.length;if(i.fn){switch(i.once&&this.removeListener(d,i.fn,void 0,!0),l){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,b),!0;case 3:return i.fn.call(i.context,b,f),!0;case 4:return i.fn.call(i.context,b,f,m),!0;case 5:return i.fn.call(i.context,b,f,m,_),!0;case 6:return i.fn.call(i.context,b,f,m,_,L),!0}for(k=1,T=new Array(l-1);k<l;k++)T[k-1]=arguments[k];i.fn.apply(i.context,T)}else{var y,v=i.length;for(k=0;k<v;k++)switch(i[k].once&&this.removeListener(d,i[k].fn,void 0,!0),l){case 1:i[k].fn.call(i[k].context);break;case 2:i[k].fn.call(i[k].context,b);break;case 3:i[k].fn.call(i[k].context,b,f);break;case 4:i[k].fn.call(i[k].context,b,f,m);break;default:if(!T)for(y=1,T=new Array(l-1);y<l;y++)T[y-1]=arguments[y];i[k].fn.apply(i[k].context,T)}}return!0},h.prototype.on=function(d,b,f){return N(this,d,b,f,!1)},h.prototype.once=function(d,b,f){return N(this,d,b,f,!0)},h.prototype.removeListener=function(d,b,f,m){var _=w?w+d:d;if(!this._events[_])return this;if(!b)return q(this,_),this;var L=this._events[_];if(L.fn)L.fn!==b||m&&!L.once||f&&L.context!==f||q(this,_);else{for(var R=0,T=[],k=L.length;R<k;R++)(L[R].fn!==b||m&&!L[R].once||f&&L[R].context!==f)&&T.push(L[R]);T.length?this._events[_]=T.length===1?T[0]:T:q(this,_)}return this},h.prototype.removeAllListeners=function(d){var b;return d?(b=w?w+d:d,this._events[b]&&q(this,b)):(this._events=new C,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=w,h.EventEmitter=h,A.exports=h},717:A=>{typeof Object.create=="function"?A.exports=function(c,w){c.super_=w,c.prototype=Object.create(w.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}})}:A.exports=function(c,w){c.super_=w;var C=function(){};C.prototype=w.prototype,c.prototype=new C,c.prototype.constructor=c}},824:A=>{var c=1e3,w=60*c,C=60*w,S=24*C,N=7*S,q=365.25*S;function h(d,b,f,m){var _=b>=1.5*f;return Math.round(d/f)+" "+m+(_?"s":"")}A.exports=function(d,b){b=b||{};var f=typeof d;if(f==="string"&&d.length>0)return function(m){if(!((m=String(m)).length>100)){var _=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(m);if(_){var L=parseFloat(_[1]);switch((_[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return L*q;case"weeks":case"week":case"w":return L*N;case"days":case"day":case"d":return L*S;case"hours":case"hour":case"hrs":case"hr":case"h":return L*C;case"minutes":case"minute":case"mins":case"min":case"m":return L*w;case"seconds":case"second":case"secs":case"sec":case"s":return L*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return L;default:return}}}}(d);if(f==="number"&&isFinite(d))return b.long?function(m){var _=Math.abs(m);return _>=S?h(m,_,S,"day"):_>=C?h(m,_,C,"hour"):_>=w?h(m,_,w,"minute"):_>=c?h(m,_,c,"second"):m+" ms"}(d):function(m){var _=Math.abs(m);return _>=S?Math.round(m/S)+"d":_>=C?Math.round(m/C)+"h":_>=w?Math.round(m/w)+"m":_>=c?Math.round(m/c)+"s":m+"ms"}(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},520:(A,c,w)=>{var C=w(155),S=C.platform==="win32",N=w(539);function q(i,l){for(var y=[],v=0;v<i.length;v++){var W=i[v];W&&W!=="."&&(W===".."?y.length&&y[y.length-1]!==".."?y.pop():l&&y.push(".."):y.push(W))}return y}function h(i){for(var l=i.length-1,y=0;y<=l&&!i[y];y++);for(var v=l;v>=0&&!i[v];v--);return y===0&&v===l?i:y>v?[]:i.slice(y,v+1)}var d=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,b=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,f={};function m(i){var l=d.exec(i),y=(l[1]||"")+(l[2]||""),v=l[3]||"",W=b.exec(v);return[y,W[1],W[2],W[3]]}function _(i){var l=d.exec(i),y=l[1]||"",v=!!y&&y[1]!==":";return{device:y,isUnc:v,isAbsolute:v||!!l[2],tail:l[3]}}function L(i){return"\\\\"+i.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}f.resolve=function(){for(var i="",l="",y=!1,v=arguments.length-1;v>=-1;v--){var W;if(v>=0?W=arguments[v]:i?(W=C.env["="+i])&&W.substr(0,3).toLowerCase()===i.toLowerCase()+"\\"||(W=i+"\\"):W=C.cwd(),!N.isString(W))throw new TypeError("Arguments to path.resolve must be strings");if(W){var ee=_(W),ae=ee.device,pe=ee.isUnc,we=ee.isAbsolute,Ce=ee.tail;if((!ae||!i||ae.toLowerCase()===i.toLowerCase())&&(i||(i=ae),y||(l=Ce+"\\"+l,y=we),i&&y))break}}return pe&&(i=L(i)),i+(y?"\\":"")+(l=q(l.split(/[\\\/]+/),!y).join("\\"))||"."},f.normalize=function(i){var l=_(i),y=l.device,v=l.isUnc,W=l.isAbsolute,ee=l.tail,ae=/[\\\/]$/.test(ee);return(ee=q(ee.split(/[\\\/]+/),!W).join("\\"))||W||(ee="."),ee&&ae&&(ee+="\\"),v&&(y=L(y)),y+(W?"\\":"")+ee},f.isAbsolute=function(i){return _(i).isAbsolute},f.join=function(){for(var i=[],l=0;l<arguments.length;l++){var y=arguments[l];if(!N.isString(y))throw new TypeError("Arguments to path.join must be strings");y&&i.push(y)}var v=i.join("\\");return/^[\\\/]{2}[^\\\/]/.test(i[0])||(v=v.replace(/^[\\\/]{2,}/,"\\")),f.normalize(v)},f.relative=function(i,l){i=f.resolve(i),l=f.resolve(l);for(var y=i.toLowerCase(),v=l.toLowerCase(),W=h(l.split("\\")),ee=h(y.split("\\")),ae=h(v.split("\\")),pe=Math.min(ee.length,ae.length),we=pe,Ce=0;Ce<pe;Ce++)if(ee[Ce]!==ae[Ce]){we=Ce;break}if(we==0)return l;var be=[];for(Ce=we;Ce<ee.length;Ce++)be.push("..");return(be=be.concat(W.slice(we))).join("\\")},f._makeLong=function(i){if(!N.isString(i))return i;if(!i)return"";var l=f.resolve(i);return/^[a-zA-Z]\:\\/.test(l)?"\\\\?\\"+l:/^\\\\[^?.]/.test(l)?"\\\\?\\UNC\\"+l.substring(2):i},f.dirname=function(i){var l=m(i),y=l[0],v=l[1];return y||v?(v&&(v=v.substr(0,v.length-1)),y+v):"."},f.basename=function(i,l){var y=m(i)[2];return l&&y.substr(-1*l.length)===l&&(y=y.substr(0,y.length-l.length)),y},f.extname=function(i){return m(i)[3]},f.format=function(i){if(!N.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!N.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);var y=i.dir,v=i.base||"";return y?y[y.length-1]===f.sep?y+v:y+f.sep+v:v},f.parse=function(i){if(!N.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=m(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},f.sep="\\",f.delimiter=";";var R=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,T={};function k(i){return R.exec(i).slice(1)}T.resolve=function(){for(var i="",l=!1,y=arguments.length-1;y>=-1&&!l;y--){var v=y>=0?arguments[y]:C.cwd();if(!N.isString(v))throw new TypeError("Arguments to path.resolve must be strings");v&&(i=v+"/"+i,l=v[0]==="/")}return(l?"/":"")+(i=q(i.split("/"),!l).join("/"))||"."},T.normalize=function(i){var l=T.isAbsolute(i),y=i&&i[i.length-1]==="/";return(i=q(i.split("/"),!l).join("/"))||l||(i="."),i&&y&&(i+="/"),(l?"/":"")+i},T.isAbsolute=function(i){return i.charAt(0)==="/"},T.join=function(){for(var i="",l=0;l<arguments.length;l++){var y=arguments[l];if(!N.isString(y))throw new TypeError("Arguments to path.join must be strings");y&&(i+=i?"/"+y:y)}return T.normalize(i)},T.relative=function(i,l){i=T.resolve(i).substr(1),l=T.resolve(l).substr(1);for(var y=h(i.split("/")),v=h(l.split("/")),W=Math.min(y.length,v.length),ee=W,ae=0;ae<W;ae++)if(y[ae]!==v[ae]){ee=ae;break}var pe=[];for(ae=ee;ae<y.length;ae++)pe.push("..");return(pe=pe.concat(v.slice(ee))).join("/")},T._makeLong=function(i){return i},T.dirname=function(i){var l=k(i),y=l[0],v=l[1];return y||v?(v&&(v=v.substr(0,v.length-1)),y+v):"."},T.basename=function(i,l){var y=k(i)[2];return l&&y.substr(-1*l.length)===l&&(y=y.substr(0,y.length-l.length)),y},T.extname=function(i){return k(i)[3]},T.format=function(i){if(!N.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!N.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);return(i.dir?i.dir+T.sep:"")+(i.base||"")},T.parse=function(i){if(!N.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=k(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return l[1]=l[1]||"",l[2]=l[2]||"",l[3]=l[3]||"",{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},T.sep="/",T.delimiter=":",A.exports=S?f:T,A.exports.posix=T,A.exports.win32=f},155:A=>{var c,w,C=A.exports={};function S(){throw new Error("setTimeout has not been defined")}function N(){throw new Error("clearTimeout has not been defined")}function q(T){if(c===setTimeout)return setTimeout(T,0);if((c===S||!c)&&setTimeout)return c=setTimeout,setTimeout(T,0);try{return c(T,0)}catch{try{return c.call(null,T,0)}catch{return c.call(this,T,0)}}}(function(){try{c=typeof setTimeout=="function"?setTimeout:S}catch{c=S}try{w=typeof clearTimeout=="function"?clearTimeout:N}catch{w=N}})();var h,d=[],b=!1,f=-1;function m(){b&&h&&(b=!1,h.length?d=h.concat(d):f=-1,d.length&&_())}function _(){if(!b){var T=q(m);b=!0;for(var k=d.length;k;){for(h=d,d=[];++f<k;)h&&h[f].run();f=-1,k=d.length}h=null,b=!1,function(i){if(w===clearTimeout)return clearTimeout(i);if((w===N||!w)&&clearTimeout)return w=clearTimeout,clearTimeout(i);try{w(i)}catch{try{return w.call(null,i)}catch{return w.call(this,i)}}}(T)}}function L(T,k){this.fun=T,this.array=k}function R(){}C.nextTick=function(T){var k=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)k[i-1]=arguments[i];d.push(new L(T,k)),d.length!==1||b||q(_)},L.prototype.run=function(){this.fun.apply(null,this.array)},C.title="browser",C.browser=!0,C.env={},C.argv=[],C.version="",C.versions={},C.on=R,C.addListener=R,C.once=R,C.off=R,C.removeListener=R,C.removeAllListeners=R,C.emit=R,C.prependListener=R,C.prependOnceListener=R,C.listeners=function(T){return[]},C.binding=function(T){throw new Error("process.binding is not supported")},C.cwd=function(){return"/"},C.chdir=function(T){throw new Error("process.chdir is not supported")},C.umask=function(){return 0}},384:A=>{A.exports=function(c){return c&&typeof c=="object"&&typeof c.copy=="function"&&typeof c.fill=="function"&&typeof c.readUInt8=="function"}},539:(A,c,w)=>{var C=w(155),S=/%[sdj%]/g;c.format=function(p){if(!i(p)){for(var x=[],$=0;$<arguments.length;$++)x.push(h(arguments[$]));return x.join(" ")}$=1;for(var Q=arguments,Se=Q.length,P=String(p).replace(S,function(ie){if(ie==="%%")return"%";if($>=Se)return ie;switch(ie){case"%s":return String(Q[$++]);case"%d":return Number(Q[$++]);case"%j":try{return JSON.stringify(Q[$++])}catch{return"[Circular]"}default:return ie}}),J=Q[$];$<Se;J=Q[++$])T(J)||!v(J)?P+=" "+J:P+=" "+h(J);return P},c.deprecate=function(p,x){if(l(w.g.process))return function(){return c.deprecate(p,x).apply(this,arguments)};if(C.noDeprecation===!0)return p;var $=!1;return function(){if(!$){if(C.throwDeprecation)throw new Error(x);C.traceDeprecation?console.trace(x):console.error(x),$=!0}return p.apply(this,arguments)}};var N,q={};function h(p,x){var $={seen:[],stylize:b};return arguments.length>=3&&($.depth=arguments[2]),arguments.length>=4&&($.colors=arguments[3]),R(x)?$.showHidden=x:x&&c._extend($,x),l($.showHidden)&&($.showHidden=!1),l($.depth)&&($.depth=2),l($.colors)&&($.colors=!1),l($.customInspect)&&($.customInspect=!0),$.colors&&($.stylize=d),f($,p,$.depth)}function d(p,x){var $=h.styles[x];return $?"\x1B["+h.colors[$][0]+"m"+p+"\x1B["+h.colors[$][1]+"m":p}function b(p,x){return p}function f(p,x,$){if(p.customInspect&&x&&ae(x.inspect)&&x.inspect!==c.inspect&&(!x.constructor||x.constructor.prototype!==x)){var Q=x.inspect($,p);return i(Q)||(Q=f(p,Q,$)),Q}var Se=function(fe,le){if(l(le))return fe.stylize("undefined","undefined");if(i(le)){var Oe="'"+JSON.stringify(le).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return fe.stylize(Oe,"string")}if(k(le))return fe.stylize(""+le,"number");if(R(le))return fe.stylize(""+le,"boolean");if(T(le))return fe.stylize("null","null")}(p,x);if(Se)return Se;var P=Object.keys(x),J=function(fe){var le={};return fe.forEach(function(Oe,Ae){le[Oe]=!0}),le}(P);if(p.showHidden&&(P=Object.getOwnPropertyNames(x)),ee(x)&&(P.indexOf("message")>=0||P.indexOf("description")>=0))return m(x);if(P.length===0){if(ae(x)){var ie=x.name?": "+x.name:"";return p.stylize("[Function"+ie+"]","special")}if(y(x))return p.stylize(RegExp.prototype.toString.call(x),"regexp");if(W(x))return p.stylize(Date.prototype.toString.call(x),"date");if(ee(x))return m(x)}var Ee,xe="",Ie=!1,et=["{","}"];return L(x)&&(Ie=!0,et=["[","]"]),ae(x)&&(xe=" [Function"+(x.name?": "+x.name:"")+"]"),y(x)&&(xe=" "+RegExp.prototype.toString.call(x)),W(x)&&(xe=" "+Date.prototype.toUTCString.call(x)),ee(x)&&(xe=" "+m(x)),P.length!==0||Ie&&x.length!=0?$<0?y(x)?p.stylize(RegExp.prototype.toString.call(x),"regexp"):p.stylize("[Object]","special"):(p.seen.push(x),Ee=Ie?function(fe,le,Oe,Ae,Pe){for(var Ze=[],Le=0,je=le.length;Le<je;++Le)St(le,String(Le))?Ze.push(_(fe,le,Oe,Ae,String(Le),!0)):Ze.push("");return Pe.forEach(function(dt){dt.match(/^\d+$/)||Ze.push(_(fe,le,Oe,Ae,dt,!0))}),Ze}(p,x,$,J,P):P.map(function(fe){return _(p,x,$,J,fe,Ie)}),p.seen.pop(),function(fe,le,Oe){return fe.reduce(function(Ae,Pe){return Pe.indexOf(`
`)>=0,Ae+Pe.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?Oe[0]+(le===""?"":le+`
 `)+" "+fe.join(`,
  `)+" "+Oe[1]:Oe[0]+le+" "+fe.join(", ")+" "+Oe[1]}(Ee,xe,et)):et[0]+xe+et[1]}function m(p){return"["+Error.prototype.toString.call(p)+"]"}function _(p,x,$,Q,Se,P){var J,ie,Ee;if((Ee=Object.getOwnPropertyDescriptor(x,Se)||{value:x[Se]}).get?ie=Ee.set?p.stylize("[Getter/Setter]","special"):p.stylize("[Getter]","special"):Ee.set&&(ie=p.stylize("[Setter]","special")),St(Q,Se)||(J="["+Se+"]"),ie||(p.seen.indexOf(Ee.value)<0?(ie=T($)?f(p,Ee.value,null):f(p,Ee.value,$-1)).indexOf(`
`)>-1&&(ie=P?ie.split(`
`).map(function(xe){return"  "+xe}).join(`
`).substr(2):`
`+ie.split(`
`).map(function(xe){return"   "+xe}).join(`
`)):ie=p.stylize("[Circular]","special")),l(J)){if(P&&Se.match(/^\d+$/))return ie;(J=JSON.stringify(""+Se)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(J=J.substr(1,J.length-2),J=p.stylize(J,"name")):(J=J.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),J=p.stylize(J,"string"))}return J+": "+ie}function L(p){return Array.isArray(p)}function R(p){return typeof p=="boolean"}function T(p){return p===null}function k(p){return typeof p=="number"}function i(p){return typeof p=="string"}function l(p){return p===void 0}function y(p){return v(p)&&pe(p)==="[object RegExp]"}function v(p){return typeof p=="object"&&p!==null}function W(p){return v(p)&&pe(p)==="[object Date]"}function ee(p){return v(p)&&(pe(p)==="[object Error]"||p instanceof Error)}function ae(p){return typeof p=="function"}function pe(p){return Object.prototype.toString.call(p)}function we(p){return p<10?"0"+p.toString(10):p.toString(10)}c.debuglog=function(p){if(l(N)&&(N=C.env.NODE_DEBUG||""),p=p.toUpperCase(),!q[p])if(new RegExp("\\b"+p+"\\b","i").test(N)){var x=C.pid;q[p]=function(){var $=c.format.apply(c,arguments);console.error("%s %d: %s",p,x,$)}}else q[p]=function(){};return q[p]},c.inspect=h,h.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},h.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=L,c.isBoolean=R,c.isNull=T,c.isNullOrUndefined=function(p){return p==null},c.isNumber=k,c.isString=i,c.isSymbol=function(p){return typeof p=="symbol"},c.isUndefined=l,c.isRegExp=y,c.isObject=v,c.isDate=W,c.isError=ee,c.isFunction=ae,c.isPrimitive=function(p){return p===null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||typeof p=="symbol"||p===void 0},c.isBuffer=w(384);var Ce=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function be(){var p=new Date,x=[we(p.getHours()),we(p.getMinutes()),we(p.getSeconds())].join(":");return[p.getDate(),Ce[p.getMonth()],x].join(" ")}function St(p,x){return Object.prototype.hasOwnProperty.call(p,x)}c.log=function(){console.log("%s - %s",be(),c.format.apply(c,arguments))},c.inherits=w(717),c._extend=function(p,x){if(!x||!v(x))return p;for(var $=Object.keys(x),Q=$.length;Q--;)p[$[Q]]=x[$[Q]];return p}}},oe={};function D(A){var c=oe[A];if(c!==void 0)return c.exports;var w=oe[A]={exports:{}};return se[A].call(w.exports,w,w.exports,D),w.exports}D.n=A=>{var c=A&&A.__esModule?()=>A.default:()=>A;return D.d(c,{a:c}),c},D.d=(A,c)=>{for(var w in c)D.o(c,w)&&!D.o(A,w)&&Object.defineProperty(A,w,{enumerable:!0,get:c[w]})},D.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),D.o=(A,c)=>Object.prototype.hasOwnProperty.call(A,c),D.r=A=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(A,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(A,"__esModule",{value:!0})};var X={};return(()=>{D.r(X),D.d(X,{LSPluginUser:()=>Hr,setupPluginUserInstance:()=>bn});var A=D(520),c=(D(856),D(996)),w=D.n(c),C=function(){return C=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var s in e=arguments[r])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},C.apply(this,arguments)};function S(t){return t.toLowerCase()}var N=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],q=/[^A-Z0-9]+/gi;function h(t,e,r){return e instanceof RegExp?t.replace(e,r):e.reduce(function(n,s){return n.replace(s,r)},t)}function d(t,e){return e===void 0&&(e={}),function(r,n){n===void 0&&(n={});for(var s=n.splitRegexp,a=s===void 0?N:s,u=n.stripRegexp,g=u===void 0?q:u,j=n.transform,U=j===void 0?S:j,z=n.delimiter,F=z===void 0?" ":z,H=h(h(r,a,"$1\0$2"),g,"\0"),Y=0,G=H.length;H.charAt(Y)==="\0";)Y++;for(;H.charAt(G-1)==="\0";)G--;return H.slice(Y,G).split("\0").map(U).join(F)}(t,C({delimiter:"."},e))}var b=D(729),f=D.n(b);function m(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const _=navigator.platform.toLowerCase()==="win32"?A.win32:A.posix,L=function(t,e){return e===void 0&&(e={}),d(t,C({delimiter:"_"},e))};class R extends f(){constructor(e,r){super(),m(this,"_tag",void 0),m(this,"_opts",void 0),m(this,"_logs",[]),this._tag=e,this._opts=r}write(e,r,n){var s;r!=null&&r.length&&r[r.length-1]===!0&&(n=!0,r.pop());const a=r.reduce((g,j)=>(j&&j instanceof Error?g+=`${j.message} ${j.stack}`:g+=j.toString(),g),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var u;this._logs.push([e,a]),(n||(s=this._opts)!==null&&s!==void 0&&s.console)&&((u=console)===null||u===void 0||u[e==="ERROR"?"error":"debug"](`${e}: ${a}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...e){this.write("INFO",e)}error(...e){this.write("ERROR",e)}warn(...e){this.write("WARN",e)}setTag(e){this._tag=e}toJSON(){return this._logs}}function T(t,...e){try{const r=new URL(t);if(!r.origin)throw new Error(null);const n=_.join(t.substr(r.origin.length),...e);return r.origin+n}catch{return _.join(t,...e)}}function k(t,e){let r,n,s=!1;const a=g=>j=>{t&&clearTimeout(t),g(j),s=!0},u=new Promise((g,j)=>{r=a(g),n=a(j),t&&(t=setTimeout(()=>n(new Error(`[deferred timeout] ${e}`)),t))});return{created:Date.now(),setTag:g=>e=g,resolve:r,reject:n,promise:u,get settled(){return s}}}const i=new Map;window.__injectedUIEffects=i;var l=D(227),y=D.n(l);function v(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const W="application/x-postmate-v1+json";let ee=0;const ae={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},pe=(t,e)=>(typeof e!="string"||t.origin===e)&&!!t.data&&(typeof t.data!="object"||"postmate"in t.data)&&t.data.type===W&&!!ae[t.data.postmate];class we{constructor(e){v(this,"parent",void 0),v(this,"frame",void 0),v(this,"child",void 0),v(this,"events",{}),v(this,"childOrigin",void 0),v(this,"listener",void 0),this.parent=e.parent,this.frame=e.frame,this.child=e.child,this.childOrigin=e.childOrigin,this.listener=r=>{if(!pe(r,this.childOrigin))return!1;const{data:n,name:s}=((r||{}).data||{}).value||{};r.data.postmate==="emit"&&s in this.events&&this.events[s].forEach(a=>{a.call(this,n)})},this.parent.addEventListener("message",this.listener,!1)}get(e,...r){return new Promise((n,s)=>{const a=++ee,u=g=>{g.data.uid===a&&g.data.postmate==="reply"&&(this.parent.removeEventListener("message",u,!1),g.data.error?s(g.data.error):n(g.data.value))};this.parent.addEventListener("message",u,!1),this.child.postMessage({postmate:"request",type:W,property:e,args:r,uid:a},this.childOrigin)})}call(e,r){this.child.postMessage({postmate:"call",type:W,property:e,data:r},this.childOrigin)}on(e,r){this.events[e]||(this.events[e]=[]),this.events[e].push(r)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class Ce{constructor(e){v(this,"model",void 0),v(this,"parent",void 0),v(this,"parentOrigin",void 0),v(this,"child",void 0),this.model=e.model,this.parent=e.parent,this.parentOrigin=e.parentOrigin,this.child=e.child,this.child.addEventListener("message",r=>{if(!pe(r,this.parentOrigin))return;const{property:n,uid:s,data:a,args:u}=r.data;r.data.postmate!=="call"?((g,j,U)=>{const z=typeof g[j]=="function"?g[j].apply(null,U):g[j];return Promise.resolve(z)})(this.model,n,u).then(g=>{r.source.postMessage({property:n,postmate:"reply",type:W,uid:s,value:g},r.origin)}).catch(g=>{r.source.postMessage({property:n,postmate:"reply",type:W,uid:s,error:g},r.origin)}):n in this.model&&typeof this.model[n]=="function"&&this.model[n](a)})}emit(e,r){this.parent.postMessage({postmate:"emit",type:W,value:{name:e,data:r}},this.parentOrigin)}}class be{constructor(e){v(this,"container",void 0),v(this,"parent",void 0),v(this,"frame",void 0),v(this,"child",void 0),v(this,"childOrigin",void 0),v(this,"url",void 0),v(this,"model",void 0),this.container=e.container,this.url=e.url,this.parent=window,this.frame=document.createElement("iframe"),e.id&&(this.frame.id=e.id),e.name&&(this.frame.name=e.name),this.frame.classList.add.apply(this.frame.classList,e.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=e.model||{}}sendHandshake(e){const r=(a=>{const u=document.createElement("a");u.href=a;const g=u.protocol.length>4?u.protocol:window.location.protocol,j=u.host.length?u.port==="80"||u.port==="443"?u.hostname:u.host:window.location.host;return u.origin||`${g}//${j}`})(e=e||this.url);let n,s=0;return new Promise((a,u)=>{const g=U=>!!pe(U,r)&&(U.data.postmate==="handshake-reply"?(clearInterval(n),this.parent.removeEventListener("message",g,!1),this.childOrigin=U.origin,a(new we(this))):u("Failed handshake"));this.parent.addEventListener("message",g,!1);const j=()=>{s++,this.child.postMessage({postmate:"handshake",type:W,model:this.model},r),s===5&&clearInterval(n)};this.frame.addEventListener("load",()=>{j(),n=setInterval(j,500)}),this.frame.src=e})}destroy(){this.frame.parentNode.removeChild(this.frame)}}v(be,"debug",!1),v(be,"Model",void 0);class St{constructor(e){v(this,"child",void 0),v(this,"model",void 0),v(this,"parent",void 0),v(this,"parentOrigin",void 0),this.child=window,this.model=e,this.parent=this.child.parent}sendHandshakeReply(){return new Promise((e,r)=>{const n=s=>{if(s.data.postmate){if(s.data.postmate==="handshake"){this.child.removeEventListener("message",n,!1),s.source.postMessage({postmate:"handshake-reply",type:W},s.origin),this.parentOrigin=s.origin;const a=s.data.model;return a&&Object.keys(a).forEach(u=>{this.model[u]=a[u]}),e(new Ce(this))}return r("Handshake Reply Failed")}};this.child.addEventListener("message",n,!1)})}}function p(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const{importHTML:x,createSandboxContainer:$}=window.QSandbox||{};function Q(t,e){return t.startsWith("http")?fetch(t,e):(t=t.replace("file://",""),new Promise(async(r,n)=>{try{const s=await window.apis.doAction(["readFile",t]);r({text:()=>s})}catch(s){console.error(s),n(s)}}))}class Se extends f(){constructor(e){super(),p(this,"_pluginLocal",void 0),p(this,"_frame",void 0),p(this,"_root",void 0),p(this,"_loaded",!1),p(this,"_unmountFns",[]),this._pluginLocal=e,e._dispose(()=>{this._unmount()})}async load(){const{name:e,entry:r}=this._pluginLocal.options;if(this.loaded||!r)return;const{template:n,execScripts:s}=await x(r,{fetch:Q});this._mount(n,document.body);const a=$(e,{elementGetter:()=>{var g;return(g=this._root)===null||g===void 0?void 0:g.firstChild}}).instance.proxy;a.__shadow_mode__=!0,a.LSPluginLocal=this._pluginLocal,a.LSPluginShadow=this,a.LSPluginUser=a.logseq=new Hr(this._pluginLocal.toJSON(),this._pluginLocal.caller);const u=await s(a,!0);this._unmountFns.push(u.unmount),this._loaded=!0}_mount(e,r){const n=this._frame=document.createElement("div");n.classList.add("lsp-shadow-sandbox"),n.id=this._pluginLocal.id,this._root=n.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${e}</div>`,r.appendChild(n),this.emit("mounted")}_unmount(){for(const e of this._unmountFns)e&&e.call(null)}destroy(){var e,r;(e=this.frame)===null||e===void 0||(r=e.parentNode)===null||r===void 0||r.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var e;return(e=this._root)===null||e===void 0?void 0:e.firstChild}get frame(){return this._frame}}function P(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const J=y()("LSPlugin:caller"),ie="#await#response#",Ee="#lspmsg#",xe="#lspmsg#error#",Ie=t=>`#lspmsg#${t}`;class et extends f(){constructor(e){super(),P(this,"_pluginLocal",void 0),P(this,"_connected",!1),P(this,"_parent",void 0),P(this,"_child",void 0),P(this,"_shadow",void 0),P(this,"_status",void 0),P(this,"_userModel",{}),P(this,"_call",void 0),P(this,"_callUserModel",void 0),P(this,"_debugTag",""),this._pluginLocal=e,e&&(this._debugTag=e.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:e}=this._pluginLocal;e?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(e={}){if(this._connected)return;const r=this,n=this._pluginLocal!=null;let s=0;const a=new Map,u=k(6e4),g=this._extendUserModel({"#lspmsg#ready#":async z=>{g[Ie(z?.pid)]=({type:F,payload:H})=>{J(`[host (_call) -> *user] ${this._debugTag}`,F,H),r.emit(F,H)},await u.resolve()},"#lspmsg#beforeunload#":async z=>{const F=k(1e4);r.emit("beforeunload",Object.assign({actor:F},z)),await F.promise},"#lspmsg#settings#":async({type:z,payload:F})=>{r.emit("settings:changed",F)},[Ee]:async({ns:z,type:F,payload:H})=>{J(`[host (async) -> *user] ${this._debugTag} ns=${z} type=${F}`,H),z&&z.startsWith("hook")?r.emit(`${z}:${F}`,H):r.emit(F,H)},"#lspmsg#reply#":({_sync:z,result:F})=>{if(J(`[sync host -> *user] #${z}`,F),a.has(z)){const H=a.get(z);H&&(F!=null&&F.hasOwnProperty(xe)?H.reject(F[xe]):H.resolve(F),a.delete(z))}},...e});var j;if(n)return await u.promise,JSON.parse(JSON.stringify((j=this._pluginLocal)===null||j===void 0?void 0:j.toJSON()));const U=new St(g).sendHandshakeReply();return this._status="pending",await U.then(z=>{this._child=z,this._connected=!0,this._call=async(F,H={},Y)=>{if(Y){const G=++s;a.set(G,Y),H._sync=G,Y.setTag(`async call #${G}`),J(`async call #${G}`)}return z.emit(Ie(g.baseInfo.id),{type:F,payload:H}),Y?.promise},this._callUserModel=async(F,H)=>{try{g[F](H)}catch{J(`[model method] #${F} not existed`)}},setInterval(()=>{if(a.size>100)for(const[F,H]of a)H.settled&&a.delete(F)},18e5)}).finally(()=>{this._status=void 0}),await u.promise,g.baseInfo}async call(e,r={}){var n;return(n=this._call)===null||n===void 0?void 0:n.call(this,e,r)}async callAsync(e,r={}){var n;const s=k(1e4);return(n=this._call)===null||n===void 0?void 0:n.call(this,e,r,s)}async callUserModel(e,...r){var n;return(n=this._callUserModel)===null||n===void 0?void 0:n.apply(this,[e,...r])}async callUserModelAsync(e,...r){var n;return e=`${ie}${e}`,(n=this._callUserModel)===null||n===void 0?void 0:n.apply(this,[e,...r])}async _setupIframeSandbox(){const e=this._pluginLocal,r=e.id,n=`${r}_lsp_main`,s=new URL(e.options.entry);s.searchParams.set("__v__",e.options.version);const a=document.querySelector(`#${n}`);a&&a.parentElement.removeChild(a);const u=document.createElement("div");u.classList.add("lsp-iframe-sandbox-container"),u.id=n,u.dataset.pid=r;try{var g;const F=(g=await this._pluginLocal._loadLayoutsData())===null||g===void 0?void 0:g.$$0;if(F){u.dataset.inited_layout="true";let{width:H,height:Y,left:G,top:ne,vw:ce,vh:ve}=F;G=Math.max(G,0),G=typeof ce=="number"?`${Math.min(100*G/ce,99)}%`:`${G}px`,ne=Math.max(ne,45),ne=typeof ve=="number"?`${Math.min(100*ne/ve,99)}%`:`${ne}px`,Object.assign(u.style,{width:H+"px",height:Y+"px",left:G,top:ne})}}catch(F){console.error("[Restore Layout Error]",F)}document.body.appendChild(u);const j=new be({id:r+"_iframe",container:u,url:s.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(e.toJSON()))}});let U,z=j.sendHandshake();return this._status="pending",new Promise((F,H)=>{U=setTimeout(()=>{H(new Error("handshake Timeout")),j.destroy()},4e3),z.then(Y=>{this._parent=Y,this._connected=!0,this.emit("connected"),Y.on(Ie(e.id),({type:G,payload:ne})=>{var ce,ve;J("[user -> *host] ",G,ne),(ce=this._pluginLocal)===null||ce===void 0||ce.emit(G,ne||{}),(ve=this._pluginLocal)===null||ve===void 0||ve.caller.emit(G,ne||{})}),this._call=async(...G)=>{await Y.call(Ie(e.id),{type:G[0],payload:Object.assign(G[1]||{},{$$pid:e.id})})},this._callUserModel=async(G,...ne)=>{if(G.startsWith(ie))return await Y.get(G.replace(ie,""),...ne);Y.call(G,ne?.[0])},F(null)}).catch(Y=>{H(Y)}).finally(()=>{clearTimeout(U)})}).catch(F=>{throw J("[iframe sandbox] error",F),F}).finally(()=>{this._status=void 0})}async _setupShadowSandbox(){const e=this._pluginLocal,r=this._shadow=new Se(e);try{this._status="pending",await r.load(),this._connected=!0,this.emit("connected"),this._call=async(n,s={},a)=>{var u;return a&&(s.actor=a),(u=this._pluginLocal)===null||u===void 0||u.emit(n,Object.assign(s,{$$pid:e.id})),a?.promise},this._callUserModel=async(...n)=>{var s;let a=n[0];(s=a)!==null&&s!==void 0&&s.startsWith(ie)&&(a=a.replace(ie,""));const u=n[1]||{},g=this._userModel[a];typeof g=="function"&&await g.call(null,u)}}catch(n){throw J("[shadow sandbox] error",n),n}finally{this._status=void 0}}_extendUserModel(e){return Object.assign(this._userModel,e)}_getSandboxIframeContainer(){var e;return(e=this._parent)===null||e===void 0?void 0:e.frame.parentNode}_getSandboxShadowContainer(){var e;return(e=this._shadow)===null||e===void 0?void 0:e.frame.parentNode}_getSandboxIframeRoot(){var e;return(e=this._parent)===null||e===void 0?void 0:e.frame}_getSandboxShadowRoot(){var e;return(e=this._shadow)===null||e===void 0?void 0:e.frame}set debugTag(e){this._debugTag=e}async destroy(){var e;let r=null;this._parent&&(r=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(r=this._getSandboxShadowContainer(),this._shadow.destroy()),(e=r)===null||e===void 0||e.parentNode.removeChild(r)}}function fe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class le{constructor(e,r){fe(this,"ctx",void 0),fe(this,"opts",void 0),this.ctx=e,this.opts=r}get ctxId(){return this.ctx.baseInfo.id}setItem(e,r){var n;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,e,r,(n=this.opts)===null||n===void 0?void 0:n.assets]})}getItem(e){var r;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,e,(r=this.opts)===null||r===void 0?void 0:r.assets]})}removeItem(e){var r;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,e,(r=this.opts)===null||r===void 0?void 0:r.assets]})}allKeys(){var e;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(e=this.opts)===null||e===void 0?void 0:e.assets]})}clear(){var e;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(e=this.opts)===null||e===void 0?void 0:e.assets]})}hasItem(e){var r;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,e,(r=this.opts)===null||r===void 0?void 0:r.assets]})}}class Oe{constructor(e){var r,n,s;s=void 0,(n="ctx")in(r=this)?Object.defineProperty(r,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[n]=s,this.ctx=e}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(e,...r){var n,s;const a=this.ensureHostScope();return e=(n=L(e))===null||n===void 0?void 0:n.toLowerCase(),(s=a.logseq.api["exper_"+e])===null||s===void 0?void 0:s.apply(a,r)}async loadScripts(...e){(e=e.map(r=>r!=null&&r.startsWith("http")?r:this.ctx.resolveResourceFullUrl(r))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...e)}registerFencedCodeRenderer(e,r){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,e,r)}registerExtensionsEnhancer(e,r){const n=this.ensureHostScope();return e==="katex"&&n.katex&&r(n.katex).catch(console.error),n.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,e,r)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function Ae(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Pe=t=>`task_callback_${t}`;class Ze{constructor(e,r,n={}){Ae(this,"_client",void 0),Ae(this,"_requestId",void 0),Ae(this,"_requestOptions",void 0),Ae(this,"_promise",void 0),Ae(this,"_aborted",!1),this._client=e,this._requestId=r,this._requestOptions=n,this._promise=new Promise((g,j)=>{if(!this._requestId)return j(null);this._client.once(Pe(this._requestId),U=>{U&&U instanceof Error?j(U):g(U)})});const{success:s,fail:a,final:u}=this._requestOptions;this._promise.then(g=>{s?.(g)}).catch(g=>{a?.(g)}).finally(()=>{u?.()})}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class Le extends b.EventEmitter{constructor(e){super(),Ae(this,"_ctx",void 0),this._ctx=e,this.ctx.caller.on("#lsp#request#callback",r=>{const n=r?.requestId;n&&this.emit(Pe(n),r?.payload)})}static createRequestTask(e,r,n){return new Ze(e,r,n)}async _request(e){const r=this.ctx.baseInfo.id,{success:n,fail:s,final:a,...u}=e,g=this.ctx.Experiments.invokeExperMethod("request",r,u),j=Le.createRequestTask(this.ctx.Request,g,e);return u.abortable?j:j.promise}get ctx(){return this._ctx}}const je=Array.isArray,dt=typeof vr=="object"&&vr&&vr.Object===Object&&vr;var _r=typeof self=="object"&&self&&self.Object===Object&&self;const Fe=dt||_r||Function("return this")(),He=Fe.Symbol;var Vt=Object.prototype,wr=Vt.hasOwnProperty,xr=Vt.toString,pt=He?He.toStringTag:void 0;const Cr=function(t){var e=wr.call(t,pt),r=t[pt];try{t[pt]=void 0;var n=!0}catch{}var s=xr.call(t);return n&&(e?t[pt]=r:delete t[pt]),s};var Zt=Object.prototype.toString;const E=function(t){return Zt.call(t)};var M=He?He.toStringTag:void 0;const B=function(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":M&&M in Object(t)?Cr(t):E(t)},V=function(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")},he=function(t){if(!V(t))return!1;var e=B(t);return e=="[object Function]"||e=="[object GeneratorFunction]"||e=="[object AsyncFunction]"||e=="[object Proxy]"},Re=Fe["__core-js_shared__"];var We,tt=(We=/[^.]+$/.exec(Re&&Re.keys&&Re.keys.IE_PROTO||""))?"Symbol(src)_1."+We:"";const Pt=function(t){return!!tt&&tt in t};var Kt=Function.prototype.toString;const Ke=function(t){if(t!=null){try{return Kt.call(t)}catch{}try{return t+""}catch{}}return""};var Sr=/^\[object .+?Constructor\]$/,Or=Function.prototype,kr=Object.prototype,Ot=Or.toString,Er=kr.hasOwnProperty,Ar=RegExp("^"+Ot.call(Er).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const jr=function(t){return!(!V(t)||Pt(t))&&(he(t)?Ar:Sr).test(Ke(t))},Ft=function(t,e){return t?.[e]},Ue=function(t,e){var r=Ft(t,e);return jr(r)?r:void 0},$e=function(){try{var t=Ue(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Yt=function(t,e,r){e=="__proto__"&&$e?$e(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r},kt=function(t){return function(e,r,n){for(var s=-1,a=Object(e),u=n(e),g=u.length;g--;){var j=u[++s];if(r(a[j],j,a)===!1)break}return e}}(),Rt=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n},rt=function(t){return t!=null&&typeof t=="object"},Qt=function(t){return rt(t)&&B(t)=="[object Arguments]"};var Xt=Object.prototype,Tr=Xt.hasOwnProperty,er=Xt.propertyIsEnumerable;const Me=Qt(function(){return arguments}())?Qt:function(t){return rt(t)&&Tr.call(t,"callee")&&!er.call(t,"callee")},ht=function(){return!1};var Ge=Z&&!Z.nodeType&&Z,Et=Ge&&!0&&K&&!K.nodeType&&K,At=Et&&Et.exports===Ge?Fe.Buffer:void 0;const Ut=(At?At.isBuffer:void 0)||ht;var Ir=/^(?:0|[1-9]\d*)$/;const tr=function(t,e){var r=typeof t;return!!(e=e??9007199254740991)&&(r=="number"||r!="symbol"&&Ir.test(t))&&t>-1&&t%1==0&&t<e},jt=function(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=9007199254740991};var te={};te["[object Float32Array]"]=te["[object Float64Array]"]=te["[object Int8Array]"]=te["[object Int16Array]"]=te["[object Int32Array]"]=te["[object Uint8Array]"]=te["[object Uint8ClampedArray]"]=te["[object Uint16Array]"]=te["[object Uint32Array]"]=!0,te["[object Arguments]"]=te["[object Array]"]=te["[object ArrayBuffer]"]=te["[object Boolean]"]=te["[object DataView]"]=te["[object Date]"]=te["[object Error]"]=te["[object Function]"]=te["[object Map]"]=te["[object Number]"]=te["[object Object]"]=te["[object RegExp]"]=te["[object Set]"]=te["[object String]"]=te["[object WeakMap]"]=!1;const ge=function(t){return rt(t)&&jt(t.length)&&!!te[B(t)]},rr=function(t){return function(e){return t(e)}};var me=Z&&!Z.nodeType&&Z,nt=me&&!0&&K&&!K.nodeType&&K,ue=nt&&nt.exports===me&&dt.process,ot=function(){try{var t=nt&&nt.require&&nt.require("util").types;return t||ue&&ue.binding&&ue.binding("util")}catch{}}(),Tt=ot&&ot.isTypedArray;const $t=Tt?rr(Tt):ge;var Dt=Object.prototype.hasOwnProperty;const nr=function(t,e){var r=je(t),n=!r&&Me(t),s=!r&&!n&&Ut(t),a=!r&&!n&&!s&&$t(t),u=r||n||s||a,g=u?Rt(t.length,String):[],j=g.length;for(var U in t)!Dt.call(t,U)||u&&(U=="length"||s&&(U=="offset"||U=="parent")||a&&(U=="buffer"||U=="byteLength"||U=="byteOffset")||tr(U,j))||g.push(U);return g};var it=Object.prototype;const Ye=function(t){var e=t&&t.constructor;return t===(typeof e=="function"&&e.prototype||it)},zt=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object);var Bt=Object.prototype.hasOwnProperty;const st=function(t){if(!Ye(t))return zt(t);var e=[];for(var r in Object(t))Bt.call(t,r)&&r!="constructor"&&e.push(r);return e},It=function(t){return t!=null&&jt(t.length)&&!he(t)},at=function(t){return It(t)?nr(t):st(t)},or=function(t,e){return t&&kt(t,e,at)},qt=function(){this.__data__=[],this.size=0},ct=function(t,e){return t===e||t!=t&&e!=e},De=function(t,e){for(var r=t.length;r--;)if(ct(t[r][0],e))return r;return-1};var lt=Array.prototype.splice;const ir=function(t){var e=this.__data__,r=De(e,t);return!(r<0)&&(r==e.length-1?e.pop():lt.call(e,r,1),--this.size,!0)},sr=function(t){var e=this.__data__,r=De(e,t);return r<0?void 0:e[r][1]},ar=function(t){return De(this.__data__,t)>-1},Ht=function(t,e){var r=this.__data__,n=De(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function Qe(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Qe.prototype.clear=qt,Qe.prototype.delete=ir,Qe.prototype.get=sr,Qe.prototype.has=ar,Qe.prototype.set=Ht;const ut=Qe,Wt=function(){this.__data__=new ut,this.size=0},Je=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Lt=function(t){return this.__data__.get(t)},cr=function(t){return this.__data__.has(t)},gt=Ue(Fe,"Map"),mt=Ue(Object,"create"),ft=function(){this.__data__=mt?mt(null):{},this.size=0},Lr=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e};var lr=Object.prototype.hasOwnProperty;const Gt=function(t){var e=this.__data__;if(mt){var r=e[t];return r==="__lodash_hash_undefined__"?void 0:r}return lr.call(e,t)?e[t]:void 0};var ur=Object.prototype.hasOwnProperty;const fr=function(t){var e=this.__data__;return mt?e[t]!==void 0:ur.call(e,t)},Mr=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=mt&&e===void 0?"__lodash_hash_undefined__":e,this};function ze(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ze.prototype.clear=ft,ze.prototype.delete=Lr,ze.prototype.get=Gt,ze.prototype.has=fr,ze.prototype.set=Mr;const Mt=ze,Nr=function(){this.size=0,this.__data__={hash:new Mt,map:new(gt||ut),string:new Mt}},Be=function(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null},yt=function(t,e){var r=t.__data__;return Be(e)?r[typeof e=="string"?"string":"hash"]:r.map},dr=function(t){var e=yt(this,t).delete(t);return this.size-=e?1:0,e},pr=function(t){return yt(this,t).get(t)},Pr=function(t){return yt(this,t).has(t)},vt=function(t,e){var r=yt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function ke(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ke.prototype.clear=Nr,ke.prototype.delete=dr,ke.prototype.get=pr,ke.prototype.has=Pr,ke.prototype.set=vt;const bt=ke,hr=function(t,e){var r=this.__data__;if(r instanceof ut){var n=r.__data__;if(!gt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new bt(n)}return r.set(t,e),this.size=r.size,this};function Xe(t){var e=this.__data__=new ut(t);this.size=e.size}Xe.prototype.clear=Wt,Xe.prototype.delete=Je,Xe.prototype.get=Lt,Xe.prototype.has=cr,Xe.prototype.set=hr;const _t=Xe,Fr=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},o=function(t){return this.__data__.has(t)};function I(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new bt;++e<r;)this.add(t[e])}I.prototype.add=I.prototype.push=Fr,I.prototype.has=o;const O=I,re=function(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1},de=function(t,e){return t.has(e)},_e=function(t,e,r,n,s,a){var u=1&r,g=t.length,j=e.length;if(g!=j&&!(u&&j>g))return!1;var U=a.get(t),z=a.get(e);if(U&&z)return U==e&&z==t;var F=-1,H=!0,Y=2&r?new O:void 0;for(a.set(t,e),a.set(e,t);++F<g;){var G=t[F],ne=e[F];if(n)var ce=u?n(ne,G,F,e,t,a):n(G,ne,F,t,e,a);if(ce!==void 0){if(ce)continue;H=!1;break}if(Y){if(!re(e,function(ve,Ne){if(!de(Y,Ne)&&(G===ve||s(G,ve,r,n,a)))return Y.push(Ne)})){H=!1;break}}else if(G!==ne&&!s(G,ne,r,n,a)){H=!1;break}}return a.delete(t),a.delete(e),H},ye=Fe.Uint8Array,wt=function(t){var e=-1,r=Array(t.size);return t.forEach(function(n,s){r[++e]=[s,n]}),r},Ve=function(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r};var Te=He?He.prototype:void 0,Jt=Te?Te.valueOf:void 0;const Vr=function(t,e,r,n,s,a,u){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!a(new ye(t),new ye(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ct(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var g=wt;case"[object Set]":var j=1&n;if(g||(g=Ve),t.size!=e.size&&!j)return!1;var U=u.get(t);if(U)return U==e;n|=2,u.set(t,e);var z=_e(g(t),g(e),n,s,a,u);return u.delete(t),z;case"[object Symbol]":if(Jt)return Jt.call(t)==Jt.call(e)}return!1},xn=function(t,e){for(var r=-1,n=e.length,s=t.length;++r<n;)t[s+r]=e[r];return t},Cn=function(t,e,r){var n=e(t);return je(t)?n:xn(n,r(t))},Sn=function(t,e){for(var r=-1,n=t==null?0:t.length,s=0,a=[];++r<n;){var u=t[r];e(u,r,t)&&(a[s++]=u)}return a},On=function(){return[]};var kn=Object.prototype.propertyIsEnumerable,Zr=Object.getOwnPropertySymbols;const En=Zr?function(t){return t==null?[]:(t=Object(t),Sn(Zr(t),function(e){return kn.call(t,e)}))}:On,Kr=function(t){return Cn(t,at,En)};var An=Object.prototype.hasOwnProperty;const jn=function(t,e,r,n,s,a){var u=1&r,g=Kr(t),j=g.length;if(j!=Kr(e).length&&!u)return!1;for(var U=j;U--;){var z=g[U];if(!(u?z in e:An.call(e,z)))return!1}var F=a.get(t),H=a.get(e);if(F&&H)return F==e&&H==t;var Y=!0;a.set(t,e),a.set(e,t);for(var G=u;++U<j;){var ne=t[z=g[U]],ce=e[z];if(n)var ve=u?n(ce,ne,z,e,t,a):n(ne,ce,z,t,e,a);if(!(ve===void 0?ne===ce||s(ne,ce,r,n,a):ve)){Y=!1;break}G||(G=z=="constructor")}if(Y&&!G){var Ne=t.constructor,Ct=e.constructor;Ne==Ct||!("constructor"in t)||!("constructor"in e)||typeof Ne=="function"&&Ne instanceof Ne&&typeof Ct=="function"&&Ct instanceof Ct||(Y=!1)}return a.delete(t),a.delete(e),Y},Rr=Ue(Fe,"DataView"),Ur=Ue(Fe,"Promise"),$r=Ue(Fe,"Set"),Dr=Ue(Fe,"WeakMap");var Yr="[object Map]",Qr="[object Promise]",Xr="[object Set]",en="[object WeakMap]",tn="[object DataView]",Tn=Ke(Rr),In=Ke(gt),Ln=Ke(Ur),Mn=Ke($r),Nn=Ke(Dr),xt=B;(Rr&&xt(new Rr(new ArrayBuffer(1)))!=tn||gt&&xt(new gt)!=Yr||Ur&&xt(Ur.resolve())!=Qr||$r&&xt(new $r)!=Xr||Dr&&xt(new Dr)!=en)&&(xt=function(t){var e=B(t),r=e=="[object Object]"?t.constructor:void 0,n=r?Ke(r):"";if(n)switch(n){case Tn:return tn;case In:return Yr;case Ln:return Qr;case Mn:return Xr;case Nn:return en}return e});const rn=xt;var nn="[object Arguments]",on="[object Array]",gr="[object Object]",sn=Object.prototype.hasOwnProperty;const Pn=function(t,e,r,n,s,a){var u=je(t),g=je(e),j=u?on:rn(t),U=g?on:rn(e),z=(j=j==nn?gr:j)==gr,F=(U=U==nn?gr:U)==gr,H=j==U;if(H&&Ut(t)){if(!Ut(e))return!1;u=!0,z=!1}if(H&&!z)return a||(a=new _t),u||$t(t)?_e(t,e,r,n,s,a):Vr(t,e,j,r,n,s,a);if(!(1&r)){var Y=z&&sn.call(t,"__wrapped__"),G=F&&sn.call(e,"__wrapped__");if(Y||G){var ne=Y?t.value():t,ce=G?e.value():e;return a||(a=new _t),s(ne,ce,r,n,a)}}return!!H&&(a||(a=new _t),jn(t,e,r,n,s,a))},an=function t(e,r,n,s,a){return e===r||(e==null||r==null||!rt(e)&&!rt(r)?e!=e&&r!=r:Pn(e,r,n,s,t,a))},Fn=function(t,e,r,n){var s=r.length,a=s;if(t==null)return!a;for(t=Object(t);s--;){var u=r[s];if(u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++s<a;){var g=(u=r[s])[0],j=t[g],U=u[1];if(u[2]){if(j===void 0&&!(g in t))return!1}else{var z=new _t,F;if(!(F===void 0?an(U,j,3,n,z):F))return!1}}return!0},cn=function(t){return t==t&&!V(t)},Rn=function(t){for(var e=at(t),r=e.length;r--;){var n=e[r],s=t[n];e[r]=[n,s,cn(s)]}return e},ln=function(t,e){return function(r){return r!=null&&r[t]===e&&(e!==void 0||t in Object(r))}},Un=function(t){var e=Rn(t);return e.length==1&&e[0][2]?ln(e[0][0],e[0][1]):function(r){return r===t||Fn(r,t,e)}},zr=function(t){return typeof t=="symbol"||rt(t)&&B(t)=="[object Symbol]"};var $n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Dn=/^\w*$/;const Br=function(t,e){if(je(t))return!1;var r=typeof t;return!(r!="number"&&r!="symbol"&&r!="boolean"&&t!=null&&!zr(t))||Dn.test(t)||!$n.test(t)||e!=null&&t in Object(e)};function qr(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError("Expected a function");var r=function(){var n=arguments,s=e?e.apply(this,n):n[0],a=r.cache;if(a.has(s))return a.get(s);var u=t.apply(this,n);return r.cache=a.set(s,u)||a,u};return r.cache=new(qr.Cache||bt),r}qr.Cache=bt;const zn=qr;var Bn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,qn=/\\(\\)?/g;const Hn=function(t){var e=zn(t,function(n){return r.size===500&&r.clear(),n}),r=e.cache;return e}(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Bn,function(r,n,s,a){e.push(s?a.replace(qn,"$1"):n||r)}),e}),Wn=function(t,e){for(var r=-1,n=t==null?0:t.length,s=Array(n);++r<n;)s[r]=e(t[r],r,t);return s};var un=He?He.prototype:void 0,fn=un?un.toString:void 0;const Gn=function t(e){if(typeof e=="string")return e;if(je(e))return Wn(e,t)+"";if(zr(e))return fn?fn.call(e):"";var r=e+"";return r=="0"&&1/e==-1/0?"-0":r},Jn=function(t){return t==null?"":Gn(t)},dn=function(t,e){return je(t)?t:Br(t,e)?[t]:Hn(Jn(t))},mr=function(t){if(typeof t=="string"||zr(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e},pn=function(t,e){for(var r=0,n=(e=dn(e,t)).length;t!=null&&r<n;)t=t[mr(e[r++])];return r&&r==n?t:void 0},Vn=function(t,e,r){var n=t==null?void 0:pn(t,e);return n===void 0?r:n},Zn=function(t,e){return t!=null&&e in Object(t)},Kn=function(t,e,r){for(var n=-1,s=(e=dn(e,t)).length,a=!1;++n<s;){var u=mr(e[n]);if(!(a=t!=null&&r(t,u)))break;t=t[u]}return a||++n!=s?a:!!(s=t==null?0:t.length)&&jt(s)&&tr(u,s)&&(je(t)||Me(t))},Yn=function(t,e){return t!=null&&Kn(t,e,Zn)},Qn=function(t,e){return Br(t)&&cn(e)?ln(mr(t),e):function(r){var n=Vn(r,t);return n===void 0&&n===e?Yn(r,t):an(e,n,3)}},Xn=function(t){return t},eo=function(t){return function(e){return e?.[t]}},to=function(t){return function(e){return pn(e,t)}},ro=function(t){return Br(t)?eo(mr(t)):to(t)},no=function(t){return typeof t=="function"?t:t==null?Xn:typeof t=="object"?je(t)?Qn(t[0],t[1]):Un(t):ro(t)},oo=function(t,e){var r={};return e=no(e),or(t,function(n,s,a){Yt(r,e(n,s,a),n)}),r};function hn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class io{constructor(e,r){hn(this,"ctx",void 0),hn(this,"serviceHooks",void 0),this.ctx=e,this.serviceHooks=r,e._execCallableAPI("register-search-service",e.baseInfo.id,r.name,r.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:n=>(je(n?.blocks)&&(n.blocks=n.blocks.map(s=>s&&oo(s,(a,u)=>`block/${u}`))),n)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach(([n,s])=>{const a=(u=>`service:search:${u}:${r.name}`)(n);e.caller.on(a,async u=>{if(he(r?.[s.f])){let g=null;try{g=await r[s.f].apply(r,(s.args||[]).map(j=>{if(u){if(j===!0)return u;if(u.hasOwnProperty(j)){const U=u[j];return delete u[j],U}}})),s.transformOutput&&(g=s.transformOutput(g))}catch(j){console.error("[SearchService] ",j),g=j}finally{s.reply&&e.caller.call(`${a}:reply`,g)}}})})}}function qe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const so=Symbol.for("proxy-continue"),ao=y()("LSPlugin:user"),gn=new R("",{console:!0});function Nt(t,e,r){var n;const{key:s,label:a,desc:u,palette:g,keybinding:j,extras:U}=e;if(typeof r!="function")return this.logger.error(`${s||a}: command action should be function.`),!1;const z=function(H){if(typeof H=="string")return H.trim().replace(/\s/g,"_").toLowerCase()}(s);if(!z)return this.logger.error(`${a}: command key is required.`),!1;const F=`SimpleCommandHook${z}${++vn}`;this.Editor["on"+F](r),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:z,label:a,type:t,desc:u,keybinding:j,extras:U},["editor/hook",F]],g]})}function mn(t){return!(typeof(e=t)!="string"||e.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(e))||(gn.error(`#${t} is not a valid UUID string.`),!1);var e}let yr=null,yn=new Map;const co={async getInfo(t){return yr||(yr=await this._execCallableAPIAsync("get-app-info")),typeof t=="string"?yr[t]:yr},registerCommand:Nt,registerSearchService(t){if(yn.has(t.name))throw new Error(`SearchService: #${t.name} has registered!`);yn.set(t.name,new io(this,t))},registerCommandPalette(t,e){const{key:r,label:n,keybinding:s}=t;return Nt.call(this,"$palette$",{key:r,label:n,palette:!0,keybinding:s},e)},registerCommandShortcut(t,e,r={}){typeof t=="string"&&(t={mode:"global",binding:t});const{binding:n}=t,s="$shortcut$",a=r.key||s+L(n?.toString());return Nt.call(this,s,{...r,key:a,palette:!1,keybinding:t},e)},registerUIItem(t,e){var r;const n=this.baseInfo.id;(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-ui-item",args:[n,t,e]})},registerPageMenuItem(t,e){if(typeof e!="function")return!1;const r=t+"_"+this.baseInfo.id,n=t;Nt.call(this,"page-menu-item",{key:r,label:n},e)},onBlockRendererSlotted(t,e){if(!mn(t))return;const r=this.baseInfo.id,n=`hook:editor:${L(`slot:${t}`)}`;return this.caller.on(n,e),this.App._installPluginHook(r,n),()=>{this.caller.off(n,e),this.App._uninstallPluginHook(r,n)}},invokeExternalPlugin(t,...e){var r;if(!(t=(r=t)===null||r===void 0?void 0:r.trim()))return;let[n,s]=t.split(".");if(!["models","commands"].includes(s?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");const a=t.replace(`${n}.${s}.`,"");if(!n||!s||!a)throw new Error(`Illegal type of #${t} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",n,s.toLowerCase(),a,e)},setFullScreen(t){const e=(...r)=>this._callWin("setFullScreen",...r);t==="toggle"?this._callWin("isFullScreen").then(r=>{r?e():e(!0)}):t?e(!0):e()}};let vn=0;const lo={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(t,e){var r;ao("Register slash command #",this.baseInfo.id,t,e),typeof e=="function"&&(e=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",e]]),e=e.map(n=>{const[s,...a]=n;if(s==="editor/hook"){let u=a[0],g=()=>{var U;(U=this.caller)===null||U===void 0||U.callUserModel(u)};typeof u=="function"&&(g=u);const j=`SlashCommandHook${s}${++vn}`;n[1]=j,this.Editor["on"+j](g)}return n}),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[t,e]]})},registerBlockContextMenuItem(t,e){if(typeof e!="function")return!1;const r=t+"_"+this.baseInfo.id;Nt.call(this,"block-context-menu-item",{key:r,label:t},e)},registerHighlightContextMenuItem(t,e,r){if(typeof e!="function")return!1;const n=t+"_"+this.baseInfo.id;Nt.call(this,"highlight-context-menu-item",{key:n,label:t,extras:r},e)},scrollToBlockInPage(t,e,r){const n="block-content-"+e;r!=null&&r.replaceState?this.App.replaceState("page",{name:t},{anchor:n}):this.App.pushState("page",{name:t},{anchor:n})}},uo={onBlockChanged(t,e){if(!mn(t))return;const r=this.baseInfo.id,n=`hook:db:${L(`block:${t}`)}`,s=({block:a,txData:u,txMeta:g})=>{a.uuid===t&&e(a,u,g)};return this.caller.on(n,s),this.App._installPluginHook(r,n),()=>{this.caller.off(n,s),this.App._uninstallPluginHook(r,n)}},datascriptQuery(t,...e){return e.pop(),e!=null&&e.some(r=>typeof r=="function")?this.Experiments.ensureHostScope().logseq.api.datascript_query(t,...e):this._execCallableAPIAsync("datascript_query",t,...e)}},fo={},po={},ho={makeSandboxStorage(){return new le(this,{assets:!0})}};class Hr extends f(){constructor(e,r){super(),qe(this,"_baseInfo",void 0),qe(this,"_caller",void 0),qe(this,"_version","0.0.17"),qe(this,"_debugTag",""),qe(this,"_settingsSchema",void 0),qe(this,"_connected",!1),qe(this,"_ui",new Map),qe(this,"_mFileStorage",void 0),qe(this,"_mRequest",void 0),qe(this,"_mExperiments",void 0),qe(this,"_beforeunloadCallback",void 0),this._baseInfo=e,this._caller=r,r.on("sys:ui:visible",n=>{n!=null&&n.toggle&&this.toggleMainUI()}),r.on("settings:changed",n=>{const s=Object.assign({},this.settings),a=Object.assign(this._baseInfo.settings,n);this.emit("settings:changed",{...a},s)}),r.on("beforeunload",async n=>{const{actor:s,...a}=n,u=this._beforeunloadCallback;try{u&&await u(a),s?.resolve(null)}catch(g){this.logger.error("[beforeunload] ",g),s?.reject(g)}})}async ready(e,r){var n,s;if(!this._connected)try{var a;typeof e=="function"&&(r=e,e={});let u=await this._caller.connectToParent(e);this._connected=!0,n=this._baseInfo,s=u,u=w()(n,s,{arrayMerge:(g,j)=>j}),this._baseInfo=u,(a=u)!==null&&a!==void 0&&a.id&&(this._debugTag=this._caller.debugTag=`#${u.id} [${u.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(u.settings=function(g,j){const U=(j||[]).reduce((z,F)=>("default"in F&&(z[F.key]=F.default),z),{});return Object.assign(U,g)}(u.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(g){console.warn(g)}r&&r.call(this,u)}catch(u){console.error(`${this._debugTag} [Ready Error]`,u)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(e){typeof e=="function"&&(this._beforeunloadCallback=e)}provideModel(e){return this.caller._extendUserModel(e),this}provideTheme(e){return this.caller.call("provider:theme",e),this}provideStyle(e){return this.caller.call("provider:style",e),this}provideUI(e){return this.caller.call("provider:ui",e),this}useSettingsSchema(e){return this.connected&&this.caller.call("settings:schema",{schema:e,isSync:!0}),this._settingsSchema=e,this}updateSettings(e){this.caller.call("settings:update",e)}onSettingsChanged(e){const r="settings:changed";return this.on(r,e),()=>this.off(r,e)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(e){this.caller.call("main-ui:attrs",e)}setMainUIInlineStyle(e){this.caller.call("main-ui:style",e)}hideMainUI(e){const r={key:0,visible:!1,cursor:e?.restoreEditingCursor};this.caller.call("main-ui:visible",r),this.emit("ui:visible:changed",r),this._ui.set(r.key,r)}showMainUI(e){const r={key:0,visible:!0,autoFocus:e?.autoFocus};this.caller.call("main-ui:visible",r),this.emit("ui:visible:changed",r),this._ui.set(r.key,r)}toggleMainUI(){const r=this._ui.get(0);r&&r.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){const e=this._ui.get(0);return!!(e&&e.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(e=this)&&(((r=e.baseInfo)===null||r===void 0?void 0:r.effect)||!((n=e.baseInfo)!==null&&n!==void 0&&n.iir));var e,r,n}get logger(){return gn}get settings(){var e;return(e=this.baseInfo)===null||e===void 0?void 0:e.settings}get caller(){return this._caller}resolveResourceFullUrl(e){if(this.ensureConnected(),e)return e=e.replace(/^[.\\/]+/,""),T(this._baseInfo.lsr,e)}_makeUserProxy(e,r){const n=this,s=this.caller;return new Proxy(e,{get(a,u,g){const j=a[u];return function(...U){if(j){const F=j.apply(n,U.concat(r));if(F!==so)return F}if(r){const F=u.toString().match(/^(once|off|on)/i);if(F!=null){const H=F[0].toLowerCase(),Y=F.input,G=H==="off",ne=n.baseInfo.id;let ce=Y.slice(H.length),ve=U[0],Ne=U[1];typeof ve=="string"&&typeof Ne=="function"&&(ve=ve.replace(/^logseq./,":"),ce=`${ce}${ve}`,ve=Ne,Ne=U[2]),ce=`hook:${r}:${L(ce)}`,s[H](ce,ve);const Ct=()=>{s.off(ce,ve),s.listenerCount(ce)||n.App._uninstallPluginHook(ne,ce)};return G?void Ct():(n.App._installPluginHook(ne,ce,Ne),Ct)}}let z=u;return["git","ui","assets"].includes(r)&&(z=r+"_"+z),s.callAsync("api:call",{tag:r,method:z,args:U})}}})}_execCallableAPIAsync(e,...r){return this._caller.callAsync("api:call",{method:e,args:r})}_execCallableAPI(e,...r){this._caller.call("api:call",{method:e,args:r})}_callWin(...e){return this._execCallableAPIAsync("_callMainWin",...e)}get App(){return this._makeUserProxy(co,"app")}get Editor(){return this._makeUserProxy(lo,"editor")}get DB(){return this._makeUserProxy(uo,"db")}get Git(){return this._makeUserProxy(fo,"git")}get UI(){return this._makeUserProxy(po,"ui")}get Assets(){return this._makeUserProxy(ho,"assets")}get FileStorage(){let e=this._mFileStorage;return e||(e=this._mFileStorage=new le(this)),e}get Request(){let e=this._mRequest;return e||(e=this._mRequest=new Le(this)),e}get Experiments(){let e=this._mExperiments;return e||(e=this._mExperiments=new Oe(this)),e}}function bn(t,e){return new Hr(t,e)}if(window.__LSP__HOST__==null){const t=new et(null);window.logseq=bn({},t)}})(),X})())})(br,br.exports);br.exports;const wn=8083,vo=8084;function bo(){return"pb-"+Math.random().toString(36).substring(2,10)}function _o(){return Number(logseq.settings?.serverPort)||wn}function wo(){const K=logseq.settings?.senderAppUrl;return K&&K.trim()?K.trim():`https://100.105.93.44:${_o()}`}function Jr(){return`http://127.0.0.1:${vo}`}async function xo(K,Z){const se=new Uint8Array(K.data);let oe="";for(let w=0;w<se.byteLength;w++)oe+=String.fromCharCode(se[w]);const D=btoa(oe),X=Jr(),A=await fetch(`${X}/save-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:K.filename,type:K.type,data:D,graphPath:Z})});if(!A.ok){const w=await A.json().catch(()=>({error:"Server error"}));throw new Error(w.error||`Save failed (${A.status})`)}const c=await A.json();return console.log("[Phone Bridge] Saved via server:",c.savedName),c.savedName}function Wr(K){logseq.provideUI({key:"phone-bridge-modal",template:K}),logseq.showMainUI({autoFocus:!1})}function Gr(K){setTimeout(()=>{const Z=parent.document.getElementById("pb-cancel");Z&&Z.addEventListener("click",K);const se=parent.document.getElementById("pb-overlay");se&&se.addEventListener("click",oe=>{oe.target.id==="pb-overlay"&&K()})},200)}function Co(K){setTimeout(()=>{const Z=parent.document.getElementById("pb-copy-btn");Z&&Z.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(K)}catch{const D=parent.document.getElementById("pb-url-text");if(D){const X=document.createRange();X.selectNodeContents(D);const A=window.getSelection();A?.removeAllRanges(),A?.addRange(X),document.execCommand("copy")}}const se=parent.document.getElementById("pb-copy-tooltip");se&&(se.classList.add("show"),setTimeout(()=>se.classList.remove("show"),1500))})},200)}class So{constructor(Z,se){this.es=null,this.sessionId=Z,this.onMsg=se}connect(){const Z=`${Jr()}/events?id=${this.sessionId}&role=receiver`;console.log("[Phone Bridge] Connecting signaling (HTTP):",Z),this.es=new EventSource(Z),this.es.onmessage=se=>{try{const oe=JSON.parse(se.data);console.log("[Phone Bridge] Sig msg:",oe.type),this.onMsg(oe)}catch(oe){console.error("[Phone Bridge] Sig parse error:",oe)}},this.es.onerror=se=>console.error("[Phone Bridge] Sig error:",se)}async send(Z){await fetch(`${Jr()}/signal?id=${this.sessionId}&role=receiver`,{method:"POST",body:JSON.stringify(Z)})}close(){this.es&&(this.es.close(),this.es=null)}}function Oo(){console.log("[Phone Bridge] Plugin loaded"),logseq.useSettingsSchema([{key:"senderAppUrl",type:"string",title:"Sender App URL (optional)",description:"Leave empty to use built-in server. For Tailscale, enter your IP like http://100.x.x.x:8083",default:""},{key:"serverPort",type:"number",title:"Server Port",description:"Port for the built-in sender server (default: 8083)",default:wn}]),logseq.provideStyle(`
    #pb-overlay {
      position: fixed; inset: 0; z-index: 999;
      display: flex; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(4px);
    }
    #pb-card {
      background: linear-gradient(145deg, #1a1a2e, #1e1e35);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px; padding: 28px; width: 360px; max-width: 90vw;
      text-align: center; color: #e0e0ff;
      font-family: -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
      box-shadow: 0 32px 64px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.04) inset;
    }
    #pb-card h3 {
      margin: 0 0 4px; font-size: 20px; font-weight: 700;
      background: linear-gradient(135deg, #e0e0ff, #b0b0ff);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    #pb-card .sub { color: #6b6b88; font-size: 12px; margin-bottom: 18px; }
    #pb-card img {
      display: block; margin: 0 auto 14px;
      width: 220px; height: 220px; border-radius: 12px;
      background: #fff; padding: 10px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    }
    .pb-url-row {
      display: flex; align-items: center; gap: 8px;
      background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px; padding: 8px 12px; margin-bottom: 14px;
      position: relative;
    }
    .pb-url-text {
      flex: 1; font-size: 11px; color: #8888aa;
      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
      text-align: left; user-select: all;
    }
    .pb-copy-btn {
      flex-shrink: 0; background: rgba(100,120,255,0.15);
      border: 1px solid rgba(100,120,255,0.2); border-radius: 8px;
      padding: 6px 8px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s ease; position: relative;
    }
    .pb-copy-btn:hover {
      background: rgba(100,120,255,0.25);
      border-color: rgba(100,120,255,0.4);
      transform: translateY(-1px);
    }
    .pb-copy-btn svg { width: 14px; height: 14px; color: #8b9eff; }
    .pb-copy-tooltip {
      position: absolute; bottom: calc(100% + 6px); left: 50%;
      transform: translateX(-50%); background: #32dc78; color: #0f0f1a;
      font-size: 10px; font-weight: 600; padding: 4px 8px;
      border-radius: 4px; white-space: nowrap;
      opacity: 0; pointer-events: none; transition: opacity 0.2s;
    }
    .pb-copy-tooltip.show { opacity: 1; }
    .pb-status {
      font-size: 13px; padding: 10px 12px; border-radius: 10px; margin-bottom: 14px;
      font-weight: 500;
    }
    .pb-wait { background: rgba(255,180,50,0.08); color: #ffb432; }
    .pb-conn { background: rgba(50,180,255,0.08); color: #32b4ff; }
    .pb-recv { background: rgba(150,100,255,0.08); color: #9664ff; }
    .pb-ok { background: rgba(50,220,120,0.08); color: #32dc78; }
    .pb-err { background: rgba(255,80,80,0.08); color: #ff5050; }
    #pb-cancel {
      width: 100%; padding: 10px;
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px; background: transparent;
      color: #6b6b88; cursor: pointer; font-size: 13px;
      transition: all 0.2s ease;
    }
    #pb-cancel:hover { background: rgba(255,80,80,0.08); color: #f66; }
  `),document.addEventListener("keydown",D=>{D.key==="Escape"&&oe()});let K=null,Z=null,se=null;function oe(){try{K&&K.close(),Z&&Z.close(),K=null,Z=null,se=null}catch{}logseq.provideUI({key:"phone-bridge-modal",template:""}),logseq.hideMainUI()}logseq.Editor.registerSlashCommand("photo",async()=>{oe();const D=bo();console.log("[Phone Bridge] Session:",D),Wr(`
      <div id="pb-overlay">
        <div id="pb-card">
          <h3> Phone Bridge</h3>
          <p class="sub">Please wait...</p>
          <div class="pb-status pb-wait">Initializing connection...</div>
          <button id="pb-cancel">Cancel</button>
        </div>
      </div>
    `),Gr(oe);try{const[{default:X}]=await Promise.all([yo(()=>import("./browser-CTB2jwNe.js").then(q=>q.b),[],import.meta.url)]),A=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});Z=A;let c=null;A.ondatachannel=q=>{const h=q.channel;se=h,h.onopen=()=>{console.log("[Phone Bridge] Data channel open");const d=parent.document.getElementById("pb-live-status");d&&(d.className="pb-status pb-conn",d.textContent="Connected! Waiting for transfer...")},h.onmessage=async d=>{try{if(d.data instanceof ArrayBuffer){if(!c){console.warn("[Phone Bridge] Got binary data without header");return}const b=new Uint8Array(d.data);c.buffer.set(b,c.receivedSize),c.receivedSize+=b.length;const f=Math.round(c.receivedSize/c.size*100),m=parent.document.getElementById("pb-live-status");if(m&&(m.textContent=`Receiving ${c.filename}... ${f}%`),c.receivedSize>=c.size){console.log("[Phone Bridge] Transfer complete!");const _={filename:c.filename,type:c.type,data:c.buffer.buffer};c=null,m&&(m.className="pb-status pb-recv",m.textContent="Saving...");const L=await logseq.App.getCurrentGraph(),R=await xo(_,L?.path);let T=`../assets/${R}`;try{const k=await logseq.App.getCurrentGraph();if(k){const l=navigator.platform.toLowerCase().includes("win")?"\\":"/";T=`file://${`${k.path.endsWith(l)?k.path.slice(0,-1):k.path}${l}assets${l}${R}`}`}}catch(k){console.error("Graph path error",k)}try{const k=await logseq.Assets.makeUrl(`assets/${R}`);k&&(T=k)}catch(k){console.error("makeUrl failed",k)}await logseq.Editor.insertAtEditingCursor(`![${_.filename}](${T})`),m&&(m.className="pb-status pb-ok",m.textContent=` Saved: ${R}`),setTimeout(oe,2e3)}}else{const b=d.data;let f;try{f=JSON.parse(b)}catch{return}if(f.type==="start"){console.log("[Phone Bridge] Starting transfer:",f.filename,f.size),c={filename:f.filename,type:f.mime,size:f.size,receivedSize:0,buffer:new Uint8Array(f.size)};const m=parent.document.getElementById("pb-live-status");m&&(m.className="pb-status pb-recv",m.textContent=`Receiving ${f.filename}... 0%`)}}}catch(b){console.error("[Phone Bridge] Transfer error:",b);const f=parent.document.getElementById("pb-live-status");f&&(f.className="pb-status pb-err",f.textContent="Transfer error"),c=null}}};const w=new So(D,async q=>{if(q.type==="offer"){await A.setRemoteDescription(new RTCSessionDescription(q.sdp));const h=await A.createAnswer();await A.setLocalDescription(h),await w.send({type:"answer",sdp:h})}else q.type==="candidate"&&q.candidate&&await A.addIceCandidate(new RTCIceCandidate(q.candidate))});K=w,w.connect(),A.onicecandidate=q=>{q.candidate&&w.send({type:"candidate",candidate:q.candidate})};const C=`${wo()}/?id=${D}`;console.log("[Phone Bridge] Sender URL:",C);const S=await X.toDataURL(C,{width:220,margin:2,color:{dark:"#1a1a2e",light:"#ffffff"}});Wr(`
        <div id="pb-overlay">
          <div id="pb-card">
            <h3> Phone Bridge</h3>
            <p class="sub">Scan with your phone to send an image</p>
            <img src="${S}" alt="QR Code" />
            <div class="pb-url-row">
              <span class="pb-url-text" id="pb-url-text" title="${C}">${C}</span>
              <button class="pb-copy-btn" id="pb-copy-btn" title="Copy URL">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                <span class="pb-copy-tooltip" id="pb-copy-tooltip">Copied!</span>
              </button>
            </div>
            <div class="pb-status pb-wait" id="pb-live-status">Waiting for phone...</div>
            <button id="pb-cancel">Cancel</button>
          </div>
        </div>
      `),Gr(oe),Co(C)}catch(X){console.error("[Phone Bridge] Init error:",X),Wr(`
        <div id="pb-overlay">
          <div id="pb-card">
            <h3> Connection Failed</h3>
            <div class="pb-status pb-err">${X.message||"Could not connect"}</div>
            <button id="pb-cancel">Close</button>
          </div>
        </div>
      `),Gr(oe)}}),logseq.Editor.registerSlashCommand("test-server",async()=>{try{const D=window.require?window.require("http"):null;if((window.require?window.require("child_process"):null)?logseq.UI.showMsg("Child Process IS available!","success"):logseq.UI.showMsg("Child Process NOT available.","warning"),!D){logseq.UI.showMsg("Node.js 'http' module not available.","error");return}const A=D.createServer((c,w)=>{w.writeHead(200),w.end("Hello from Plugin!")});A.listen(8090,"0.0.0.0",()=>{logseq.UI.showMsg("Server started on port 8090!","success"),console.log("Plugin Server running on 8090")}),A.on("error",c=>{logseq.UI.showMsg("Server error: "+c.message,"error")})}catch(D){logseq.UI.showMsg("Failed to start server: "+D.message,"error")}}),logseq.beforeunload(async()=>{K&&K.close(),Z&&Z.close()})}logseq.ready(Oo).catch(console.error);
